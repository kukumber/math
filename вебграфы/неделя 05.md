# центральность 

Центральность — это способ померять, насколько та или иная вершина сложной сети является влиятельность, насколько она имеет центральное значение в этой сети.
## betweenness

**Betweenness centrality** — это доля кратчайших путей, проходящих через данную вершину.

Пусть $P(u,v)$ — множество кратчайших путей из вершины $u$ в вершину $v$. $P(u,v,t)$ — множество кратчайших путей из вершины $u$ в вершину $v$, проходящих через вершину $t$.

Тогда мера центральности betweenness:
$$b(t)=\sum_{u\ne t,v\ne t}\frac{|P(u,v,t)|}{|P(u,v)|}$$
Пример:
![[неделя 05.png|w40]]
Найдем $b(4)$.

От 1 до 5 два кратчайших пути:
![[неделя 05-1.png|w40]]
![[неделя 05-2.png|w40]]
На обоих лежит вершина 4.
$$\frac{|P(1,5,4)|}{|P(1,5)|}=1$$

Аналогично, вершина 4 лежит на всех кратчайших путях из $u$ в $v$, где $u\in \{1,2,3\}$, $v\in\{5,6,7 \}$. 

В итоге $b(4)=9$.

Найдем $b(2)$.

Есть два кратчайших пути из 1 в 7
![[неделя 05-3.png|w40]]
![[неделя 05-4.png|w40]]
и только один из них проходит через вершину 2.
$$\frac{|P(1,7,2)|}{|P(1,7)|}=\frac{1}{2}$$
Аналогично с путями из 1 в 4, из 1 в 5 и из 1 в 6. Таким образом:
$$b(2)=\frac{1}{2}+\frac{1}{2}+\frac{1}{2}+\frac{1}{2}=2$$
В итоге по всем вершинам:
$$\begin{aligned}
b(4) &= 9 \\
b(5) &= 8 \\
b(2) &= 2 \\
b(3) &= 2 \\
b(1) &= 0 \\
b(6) &= 0 \\
b(7) &= 0 \\
\end{aligned}$$
Пример сети с наиболее значимыми вершинами:
![[неделя 05-5.png|w40]]

## closeness

Closeness centrality — величина, обратная сумме расстояний до остальных вершин:
$$c(v)=\frac{1}{\sum_{u\in V,u\ne v}d(u,v)}$$
где $d(u,v)$ — расстояние между вершинами $u$ и $v$.

Пример:
![[неделя 05-6.png|w40]]
Расстояние $d(1,2)=1$:
![[неделя 05-7.png|w40]]
$d(1,3)=1$:
![[неделя 05-8.png|w40]]
$d(1,4)=2$:
![[неделя 05-9.png|w40]]
$d(1,5)=3$: 
![[неделя 05-10.png|w40]]
$d(1,6)=4$:
![[неделя 05-11.png|w40]]
$d(1,7)=4$:
![[неделя 05-12.png|w40]]

$$\begin{aligned}
d(1,2) &= 1\\
d(1,3) &= 1\\
d(1,4) &= 2\\
d(1,5) &= 3\\
d(1,6) &= 4\\
d(1,7) &= 4
\end{aligned}$$
Соответственно $c(1)$:
$$c(1)=\frac{1}{1+1+2+3+4+4}=\frac{1}{15}$$
Аналогично $c(2)$:
$$c(2)=\frac{1}{1+1+1+2+3+3}=\frac{1}{11}$$
В результате получается:
$$\begin{aligned}
c(1) &= \frac{1}{15} \\
c(2) &= c(3) = \frac{1}{11} \\
c(4) &= \frac{1}{9} \\
c(5) &= \frac{1}{13} \\
c(6) &= c(7) = \frac{1}{18}
\end{aligned}$$
Пример сети с наиболее значимыми вершинами:
![[неделя 05-13.png|w40]]
## eigenvector

Eigenvector centrality — величина, пропорциональная сумме центральностей соседей:
$$x(v)=\frac{1}{\lambda}\sum_{u\in N_v}x(u),\lambda = \text{const}$$
Вершина с высокой центральностью смежна с другими вершинами высокой центральности.

Для примера
![[неделя 05.png|w40]]
значения будут следующие:
$$\begin{aligned}
x(1) &= 0.36 \\
x(2) &= 0.49 \\
x(3) &= 0.49 \\
x(4) &= 0.48 \\
x(5) &= 0.31 \\
x(6) &= 0.18 \\
x(7) &= 0.18
\end{aligned}$$
Пример сети с наиболее значимыми вершинами:
![[неделя 05-14.png|w40]]
# пейджранк

Пусть $G_n=(V_n, E_n)$ — веб-граф.

Пейджранк определяется как решение:
$$\pi(n)=\big(\pi_i(n)\big)_{i=1, \ldots, |V_n|}$$
системы линейных уравнений:
$$\pi_i(n)=c\sum_{j\to i}\frac{\pi_j(n)}{\text{outdeg }j} + \frac{1-c}{|V_n|} + \frac{c}{|V_n|}\sum_{j:\text{outdeg } j=0}\pi_j(n), i=1,\ldots,|V_n|$$
где $c\in(0,1)$ — константа.

$j\to i$ означает, что мы смотрим на те вершины, которые ссылаются на вершину $i$. То есть вся входящая окрестность вершины $i$.

$\text{outdeg }j$ — исходящая степень вершины $j$.

Последнее слагаемое позволяет учесть те вершины, у которых исходящая степень равна нулю.

Интерпретация: человек, который блуждает по сети с вероятностью $c$ на очередном шаге переходит по ссылке, а с вероятностью $(1-c)$ совершает «скачок» на случайную страницу.

Величина $(1-c)$ называется *вероятностью телепортации*.

Пример веб-графа:
![[неделя 05-15.png|w40]]
При $c=0.9$:
$$\begin{aligned}
\pi_1 &= 0.0919 \\
\pi_2 &= 0.1230 \\
\pi_3 &= 0.2475 \\
\pi_4 &= 0.3457 \\
\pi_5 &= 0.1921 \\
\end{aligned}$$
Для примера рассмотрим $\pi_4$:
$$\pi_4 = 0.9\cdot \bigg(\frac{\pi_3}{1}+\frac{\pi_2}{2}\bigg)+\frac{0.1}{5}+\frac{0.9}{5}\pi_1$$

Пример сети с наиболее значимыми вершинами:
![[неделя 05-16.png|w40]]
Координаты $\pi_i(n)$ пейджранка подчиняются степенному закону.

В модели Боллобаша-Риордана пейджранк неудобно считать из-за петель.

Еще один вариант конкретизации модели Барабаши-Альберт:
- в каждый момент времени добавляем одну вершину и $m$ ребер
- начинаем с вершины 0 без ребер, но с весом, равным $m$
- вершина 1 ставит $m$ ссылок на 0; вес вершины 0 становится равным $2m$, вес вершины 1 становится  $m$
- дальнейшие вершины ставят $m$ ссылок независимо, каждую с вероятностью, пропорциональной весам существующих вершин (равным сумме их входящих степеней и $m$):
$$P(n+1\to i)=\frac{\text{indeg }i+m}{\sum_{k=0}^n(\text{indeg }k+m)}=\frac{\text{indeg }i + m}{2mn+m}$$
## теорема (Авраченков)

При $i>0$:
$$\begin{aligned}
\mathbb{E}\pi_i(n) &=\frac{1-c}{1+n}\bigg(\frac{1}{1+c}+\frac{c\Gamma\big(i+\frac{1}{2}\big)\Gamma\big(n+\frac{c}{2}+1\big)}{(1+c)\Gamma\big(i+\frac{c}{2}+1\big)\Gamma\big(n+\frac{c}{2}\big)}\bigg)\approx \\
&\approx\frac{1-c}{1+n}\bigg(\frac{1}{1+c}+\frac{c}{1+c}\bigg(i+\frac{1}{2}\bigg)^{-\frac{1+c}{2}}\bigg(n+\frac{1}{2}\bigg)^{\frac{1+c}{2}}\bigg)
\end{aligned}$$
Величина $\pi_v(n)$ не дискретна, а абсолютно непрерывна. $p_n(x)$ — плотность пейджранка.

Согласно теореме плотность:
$$p_n(x)=\frac{2}{1-c}(n+1)\bigg(1+\frac{1}{2}\bigg)c^{\frac{2}{1+c}}\bigg(\frac{1+c}{1-c}(n+1)x-1\bigg)^{-\frac{3+c}{1+c}}\approx\Theta\bigg(\frac{1}{x^{\frac{3+c}{1+c}}}\bigg)$$
Степенной закон с параметром $\frac{3+c}{1+c}$.

При $c=0.85$:
$$\frac{3+c}{1+c}\approx 2.1$$

# weighted Yandex PageRank

Пусть $G_n=(V_n, E_n)$ — веб-граф.

Каждой вершине $i\in V$ ставим в соответствие вектор признаков $\mathbf{v}_i$ размерности $l$, а каждому ребру $i\to j$ из $E$ — вектор признаков $\mathbf{e}_{i,j}$  размерности $m$.

Введем основные параметры:

- вектор $\omega$ размерности $l$, который определяет вес вершины $i\in V$: $f(\omega, i)=(\omega, \mathbf{v}_i)$ — скалярное произведение
- вектор $\varphi$ размерности $m$, который определяет вес ребра $i\to j$ из $E$: $g(\varphi, i\to j)=(\varphi, \mathbf{e}_{i,j})$

Третий вспомогательный параметр $c\in(0,1)$.

Пусть $\mathbb{I}(i\to j)=1$, если есть ребро $i\to j$ и $\mathbb{I}(i\to j)=0$ иначе.

**основное определение**

Взвешенный пейджранк  — это вектор $\pi$, являющийся решением системы $\pi = A\pi$, где $A$ — матрица из элементов:
$$A_{i,j}=(1-c)\frac{f(\omega,j)}{\sum_{k\in V}f(\omega, k)}+
\begin{cases}
c\frac{g(\varphi,j\to i)}{\sum_{h:j\to i}}\cdot\mathbb{I}(j\to i), &\text{if outdeg }j > 0\\
\frac{c\cdot f(\omega, j)}{\sum_{k\in V}f(\omega, k)}, &\text{otherwise}
\end{cases}$$
В случае $f(\omega, i)\equiv 1$, $g(\varphi, i\to j)\equiv 1$
$$A_{i,j}=\frac{1-c}{|V|}+
\begin{cases}
\frac{c}{\text{outdeg }j}\cdot \mathbb{I}(j\to i), &\text{if outdeg }j > 0\\
\frac{c}{|V|}, &\text{otherwise}
\end{cases}$$
и это классический пейджранк $\pi_i=\sum_j A_{i,j}\pi_j$.

**основная задача**

Пусть $S$ — мера различия между таким пейджранком $\pi(\omega, \varphi, c)$ и некоторой оценкой, присвоенной каждому документу (то есть, каждой вершине $i\in V$) в соответствии с данным поисковым запросом (например, $S$ — стандартное отклонение). Найти
$$(\omega_0,\varphi_0, c_0)=\arg\min_{\omega,\varphi,c}S\big(\pi(\omega, \varphi, c), \text{vector of estimates}\big)$$
