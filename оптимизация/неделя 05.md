# задача выпуклой оптимизации

Задача выпуклой оптимизации — это такая задача оптимизации, в которой минимизируемая функция
$$\min f(x)$$
является выпуклой, ограничения типа неравенств определяются выпуклыми функциями
$$h_j(x)\le 0,j=1,\ldots,p$$
и ограничения типа равенств линейные, то есть представляются в виде
$$Ax=b$$
Матрица $A$ чаще всего недоопределенная, то есть количество строк в ней меньше количества столбцов.

Требование на выпуклость функций $h_j$ продиктовано тем, что, если есть выпуклая функция, то можно доказать, что ее множество подуровней, то есть множество $x$, которые меньше некоторой константы, образуют выпуклое множество.

Кратко задачу можно описать как задачу минимизации выпуклой функции на выпуклом множестве.

Поскольку у выпуклой функции совпадает локальный и глобальный минимум, то, используя методы локального поиска, то есть методы, которые учитывают только локальное поведение функции в точке, можно найти и получить глобальный минимум, найдя локальный минимум.

# транспортная задача

Допустим есть некоторое количество магазинов и некоторое количество складов с товаром. Известны:

- стоимость доставки единицы товара $c_{ij}$ со склада $i$ до магазина $j$
- время доставки $t_{ij}$ со склада $i$ до магазина $j$
- объем груза $b_j$, необходимый для магазина $j$
- объем товара $a_i$ на складе $i$

Требуется минимизировать суммарную стоимость, время или что-то среднее между ними, то есть оптимизировать процесс перевозки так, чтобы во всех магазинах было достаточное количество товара, но, в то же время, невозможно привезти с некоторого склада больше товара, чем на нем имеется в наличии.

Переменная $x_{ij}$, которую требуется найти, — это количество товара, который нужно перевезти со склада $i$ в магазин $j$.

Ограничения:
1. Поскольку это товар, он не может быть отрицательным:
$$x_{ij}\ge 0$$
2. Со склада нельзя увезти больше товара, чем на нем имеется:
$$\sum_{j}x_{ij}\le a_i$$
3. В каждом магазине должно быть столько товара, сколько магазину требуется:
$$\sum_i x_{ij}=b_j$$
Целевая функция формулируется как минимизация суммарной стоимости перевозок
$$\min \sum_{ij}c_{ij}x_{ij}+\gamma\sum_{ij}t_{ij}x_{ij}$$
То есть, в первом слагаемом берем количество товара, перемножаем на все стоимости доставки с кажого склада.

Во втором слагаемом количество товара умножается на время перевозки. Из постановки задачи непонятно, что важнее: скорость перевозки товара или суммарная стоимость, поэтому вводится коэффициент $\gamma$, который балансирует величину суммарной стоимости и времени.

Посмотрим для начала на ограничения. Первое ограничение — выпуклая функция. Второе и третье — линейные комбинации, тоже выпуклые, потому что аффинные.

Целевая функция линейна по $x$, поэтому тоже выпуклая.

Получается, что транспортная задача — задача выпуклой оптимизации и, более того, поскольку и целевая функция и ограничения линейны, эта задача линейного программирования.

## анализ постановки

Эта задача многокритериальной оптимизации, которая искусственно была сделана скалярной. То есть два критерия стоимость и время, были линейно скомбинированы при помощи коэффициента $\gamma$ в функцию, которая принимает не векторные, а скалярные значения.

Коэффициент $\gamma$ регулирует, какой из критериев более важен. Для каждой конкретной ситуации этот параметр необходимо настраивать.

# регрессия

Допустим, у нас есть выборка, состоящая из векторов $x_i$ и чисел $y_i$
$$(x_i,y_i),x_i\in\mathbb{R}^n,y_i\in\mathbb{R}$$
Мы предполагаем, что есть некоторая параметрическая функция $f(x_i,w)$, такая, что
$$y_i\approx f(x_i,w)$$
для некоторого фиксированного $w$ и всех пар $x_i$ и $y_i$.

Для того, чтобы найти $w$ предлагается следующая оптимизационная задача
$$\sum_{i=1}^m l\big(y_i-f(x_i,w)\big)\to\min_w$$
где $l$ — это некоторая функция качества, которая отображает предпочтения о том, как будет измеряться то, насколько $y_i$ отличается от значения, возвращаемого функцией $f$. Предполагается эту функцию минимизировать по $w$. И дальше можно использовать функцию $f$ с параметром $w^*$, который является решением задачи для того, чтобы приближать неизвестные значения $y$, для новых векторов $x_i$.

Пусть функция $f(x_i,w)$ — линейна, то есть
$$f(x,w)=w^Tx$$
тогда можно рассмотреть следующие случаи

- **задача наименьших квадратов**
$$\min_x||Xw-y||_2^2$$
Эта задача выпукла, потому что норма — выпуклая функция, в силу неравенства треугольника, а суперпозиция нормы и аффинной функции — выпуклая, в силу правил композиции.

Для такой задачи есть способы аналитического решения.

- **минимизация суммы абсолютных отклонений**
$$\min_x||Xw-y||_1$$
С выпуклостью дела обстоят точно так же, как в задаче наименьших квадратов, однако в этой ситуации нет аналитического решения.

- **минимаксная оценка**
$$\min_x\big[||Xw-y||_\infty=\max_i|w^Tx_i=y_i|\big]$$

К выбросам наиболее устойчива первая норма. 

Часто добавляют ограничения
$$b_i\le w_i\le u_i$$
и/или
$$\sum_{i=1}^nw_i=1$$
Эти ограничения не меняют выпуклости, потому что являются по сути аффинными.

# решение не доопределенной системы

Недоопределенная система линейных уравнений — это такая система линейных уравнений, в которой матрица $A$ прямоугольная
$$Ax=b$$
где $A\in\mathbb{R}^{m\times n}$, при этом число строк в ней сильно меньше числа столбцов $m \ll n$.

В этом случае решений системы очень много.

Стандартный способ — добавить требование минимальности некоторой нормы решения
$$\min||x||$$
В зависимости от того, какая норма используется, решение будет обладать разными свойствами.

Эта задача является выпуклой.

## геометрическая интерпретация

Множество $\{x|Ax=b\}$ — аффинно. 

Целевую функцию можно интерпретировать как расстояние от 0 до точки $x$ из этого множества.

Задача в целом — это поиск проекции 0 на аффинное множество.

Как зависит свойство решения от выбора нормы.

### $l_2$ норма

$$\min||x||^2_2$$

Это классический подход. Если опереться на геометрическую интерпретацию, то это обычное евклидово расстояние.

Такая задача имеет аналитическое решение.

## $l_1$ норма

$$\min||x||_1$$
Главное, что дает этот подход, — разреженное решение. При $l_2$ норме скорее всего все компоненты $x$ будут ненулевыми. То есть каждый столбец матрицы $A$ будет давать какой-то вклад. При $l_1$ норме скорее всего много компонент $x$ будут равны нулю и только некоторые столбцы матрицы $A$ будут давать существенный вклад в получение вектора $b$.

Релаксация требования минимизации числа ненулевых элементов в $x$.

Compressed sensing.

## произвольный штраф

Например, есть конкретные сведения о том, как следует штрафовать конкретные значения $x$ для каждого столбца матрицы $A$. В этом случае, вместо того, чтобы учитывать норму всего вектора, ставится явно штраф на величины компонент вектора
$$\min\phi_1(x_1)+\ldots+\phi_n(x_n)$$
$\phi_i(u)$ — выпуклая функция.

# эллипсоид минимального объема

Дан некоторый набор точек
$$x_i\in \mathbb{R}^n, i =1,\ldots, N$$
Необходимо найти эллипсоид минимального объема, который содержит все точки.

**Приложения задачи**:
- телекоммуникации
- робототехника
- аппроксимация выпуклых оболочек

**Параметры эллипсоида** — матрица и вектор. Матрица отвечает за поворот и растяжение/сжатие по некоторым осям, вектор — за сдвиг от начала координат.

**Ограничения**:
- для шара радиуса $R$: 
$$||x||_2\le R$$
- для эллипсоида
$$||Ax+b||_2\le 1$$
матрица $A$ должна быть положительно определена
$$A \succ 0$$
**Целевая функция** — это объем эллипса, который необходимо минимизировать. 

При некотором преобразовании $g$ объем меняется пропорционально модулю детерминанта матрицы Якоби $J$. Так как преобразование может менять ориентацию пространства, но модуль фиксирует то, что требуется выяснить насколько сжались или растянулись базовые векторы.

В случае линейного преобразования с матрицей $A$, матрица Якоби $J=A$.

Из ограничений следует, что $A$ — преобразование из эллипсоида в шар. 

Матрица преобразования шара в эллипсоид $A^{-1}$.

В итоге получается задача минимизации определителя $A^{-1}$
$$\min_{A\succ0}\det A^{-1}$$
при условии, что все точки лежат внутри эллипса, который был получен при помощи преобразования при помощи $A^{-1}$ по отношению к шару
$$||Ax_i+b||_2\le1,i=1,\ldots,N$$

## анализ промежуточной задачи

У нас есть ограничения и целевая функция. Поскольку в ограничении фигурирует норма, которая является выпуклой функцией, а внутренняя функция аффинна, то их суперпозиция — выпуклая функция.

## выпуклая постановка задачи

Логарифм определителя от положительно определенной матрицы является вогнутой функцией от этой матрицы
$$\log\det A, for \ A\succ0$$
Для нашей задачи это дает
$$\max_{A\succ0}\log\det A$$
с ограничением типа неравенств
$$||Ax_i+b||_2\le1,i=1,\ldots,N$$
Минимум меняется на максимум по следующей причине. Поскольку
$$\det A^{-1}=\frac{1}{\det A}$$
поэтому
$$\log\det A^{-1}=\frac{\log 1}{\log \det A}$$
и тогда по свойству логарифма получается
$$-\log \det A$$
а минимум от минуса функции — это максимум от самой функции.

Если функция $f$ вогнута, то $-f$  — выпуклая.

Максимизация вогнутой функции при выпуклых ограничениях дает выпуклую задачу.