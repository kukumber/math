# существование решения

## теорема Вейерштрасса

Пусть $f(x)$ непрерывна на $\mathbb{R}^n$, множество $L_\alpha=\{x:f(x)\le\alpha\}$ для некоторого $\alpha$ непусто и ограниченно. Тогда существует точка глобального минимума на $f(x)$ на $\mathbb{R}^n$.

**доказательство**

Возьмем последовательность $x_k$ и пусть
$$f(x_k)\to\inf_{x\in\mathbb{R}^n}f(x)<\alpha$$
Тогда $x_k$ для достаточно больших $k$ лежит во множестве подуровня $L_\alpha$
$$x_k\in L_\alpha$$
Множество $L_\alpha$ будет замкнуто в силу непрерывности $f(x)$ и ограничено. То есть компактно.

Поэтому последовательность $\{x_k\}$ имеет предел $x^*\in L_\alpha$.

Из непрерывности $f(x)$ следует
$$f(x^*)=\inf_{x\in\mathbb{R}^n}f(x)$$
следовательно, можно выразить $x^*$
$$x^*=\arg\min_{x\in\mathbb{R}^n}f(x)$$

Требование ограниченности нельзя ослабить. Например в $\mathbb{R}^1$ есть две функции $f(x)=x$ и $f(x)=\frac{1}{1+x}$. Обе функции непрерывны, но точек минимума не имеют.

**замечания**

Множество подуровня (множество Лебега) функции:
$$L_\alpha=\{x\in X:f(x)\le \alpha,\alpha=\text{const}\}$$
Если $f(x)$ — выпуклая функция, то множество $L_\alpha$ является выпуклым.

**альтернативная формулировка теоремы**

Пусть $X$ — компакт и $f(x)$ — непрерывная функция на $X$. Тогда точка глобального минимума функции $f$ на $X$ существует.

Точка минимума строго выпуклой, а следовательно сильно выпуклой функции, глобальна и единственна.

## условия оптимальности

Условие оптимальности — это выражение, которое дает либо необходимое, либо достаточное условие экстремума.

Условия оптимальности могут быть:
- необходимые (если точка экстремум, то выполняется ...)
- достаточные (если выполняется условие, то это экстремум)
- локальные
- глобальные
- первого порядка (градиент, первая производная)
- второго порядка (гессиан, вторая производная)

Классы задач:
- задача безусловной минимизации
$$\min_{x\in\mathbb{R}^n} f(x)$$
- задача условной минимизации
$$\min_{x\in X} f(x)$$
- задача минимизации с ограничениями типа равенств и неравенств (задача математического программирования)

**замечания**

- $x^*$ — локальный минимум $f(x)$ на множестве $X$ если существует $\varepsilon>0$ и такая окрестность, что в этой окрестности для любой точки $x$ из пересечения множества с этой окрестностью значение в точке $x^*$ меньше, чем значение $f(x)$
$$f(x)\ge f(x^*) \ \forall x\in X \cap U_{\varepsilon}(x_*)$$
$$U_{\varepsilon}(x_*)=\{x\big| \ ||x - x_*||\le \varepsilon\}$$

- для задачи минимизации эквивалентной задачей будет
$$\max_{x\in X}-f(x)$$
## безусловная оптимизация

Необходимо найти минимум какой-то гладкой функции на всем пространстве
$$\min_{x\in\mathbb{R}^n}f(x)$$
### необходимое условие первого порядка

**теорема Ферма**
Пусть $x^*$ — точка минимума $f(x)$ на $\mathbb{R}^n$. Функция $f(x)$ дифференцируема в точке $x^*$. Тогда 
$$\nabla f(x^*)=0$$

**доказательство**
Пусть $\nabla f(x^*)\ne0$. Рассмотрим точку $\overline x=x^*-\gamma \nabla f(x^*)$, то есть, сдвинемся по направлению антиградиента. Разложим до первого порядка функцию в этой точке
$$f(\overline x)=f(x^*)-\gamma || \nabla f(x^*)||^2+o(\gamma)$$
вынесем $\gamma$ за скобку
$$f(\overline x)=f(x^*)-\gamma\bigg(||\nabla f(x^*)||^2+\frac{o(\gamma)}{\gamma}\bigg)$$
при $\gamma\to 0$ и $\gamma>0$ дробь будет стремиться к нулю, вся скобка будет положительна. Тогда получается, что $f(\overline x)<f(x^*)$. А это противоречие с тем, что точка $x^\ast$ — это точка локального минимума.

Если в точке не выполняется условие экстремума, то это есть метод, как можно построить точку, значение функции в которой будет меньше.

### достаточное условие первого порядка

❗️ Для **выпуклых** функций необходимое условие будет достаточным.

**теорема**

Если функция $f(x$) — выпукла и дифференцируема в точке $x^\ast$ и $\nabla f(x^\ast)=0$, тогда $x^\ast$ — точка глобального минимума $f(x)$ на $\mathbb{R}^n$.

**доказательство**

Функция выпукла, значит для любых $x$ и $y$ выполняется неравенство
$$f(x)\ge f(x^\ast)+(\nabla f(x^\ast),x-x^\ast)=f(x^\ast), \forall x\in\mathbb{R}^n$$

### необходимое условие второго порядка

**теорема**

Пусть $x^\ast$ — точка минимума $f(x)$ на $\mathbb{R}^n$. Функция $f(x)$ дважды дифференцируема в точке $x^\ast$. Тогда 
$$\nabla^2 f(x^\ast)\ge0$$

### достаточное условие второго порядка

**теорема**

Пусть $x^\ast$ — точка минимума $f(x)$ на $\mathbb{R}^n$. Функция $f(x)$ дважды дифференцируема в точке $x^\ast$, выполнено условие первого порядка и $\nabla^2 f(x^\ast)>0$. Тогда $x^\ast$ — точка локального минимума.




### пример
Алгоритм:
$$\min_x f(x)$$
считаем градиент
$$\nabla f(x)$$
находим стационарные точки
$$\nabla f(x_\ast)=0$$
анализ $x_\ast$ с помощью достаточных условий.


**пример 1**
$$f(x)=x_1^2-x_1x_2+x_2^2-2x_1+x_2\to \min_{x\in\mathbb{R}^2}$$
считаем градиент
$$\nabla f(x)=\begin{pmatrix}
2x_1-x_2-2 \\
-x_1+2x_2+1
\end{pmatrix}$$
приравниваем градиент к нулю
$$\nabla f(x)=0$$
получаем стационарную точку
$$x_\ast=(1,0)$$
воспользуемся достаточным условием второго порядка
$$\nabla^2f(x_\ast)=\begin{pmatrix}
2 & -1 \\
-1 & 2
\end{pmatrix}>0$$
тогда — это локальный минимум
$$x^\ast=(1,0)$$
Можно сказать, что это условие достаточно, чтобы функция была строго выпуклая, следовательно и просто выпуклая. А значит, это не просто локальный, а глобальный минимум функции.


### связь субдифференциала с безусловной минимизацией

**лемма**

Пусть функция $f(x)$ — выпуклая, точка $x^\ast$ — точка глобального минимума $f(x)$ на $\mathbb{R}^n$ тогда и только тогда, когда
$$0\in\partial f(x^\ast)$$
То есть условие, что ноль лежит в субдифференциале в данной точке — это необходимое и достаточное условие глобального минимума для выпуклой функции.

**пример**

$$\min_{x\in\mathbb{R}^n}||x||-c^Tx, c\in\mathbb{R}^n$$
Функция выпуклая, потому что норма — выпуклая, линейная функция и выпуклая и вогнутая.

Можно использовать теорему Рокафеллера и рассмотреть эту комбинацию как сумму двух выпуклых функций.

НДУ: $0\in\partial f(x^\ast)$

Для этого посчитаем субдифференциал на всем $\mathbb{R}^n$
$$\partial f(x)=\begin{cases}
B_1(0)-c, &x=0\\
\frac{x}{||x||}-c, & x\ne 0
\end{cases}$$
Может ли 0 лежать во множестве $B_1(0)-c$? Может, если $||c||\le 1$, тогда $x^\ast=0$.

Когда градиент $\frac{x}{||x||}-c$ равен нулю? Тогда, когда $||c||=1$, тогда $x^\ast=\lambda c$, где $\lambda>0$.

Если $||c||<1$, $x^\ast=0$.
Если $||c||=1$, $x^\ast=\lambda c,\lambda\ge0$
Если $||c||>1$, нет решений.


## условная минимизация

### задача условной минимизации

**теорема**

Пусть есть выпуклое множество $X$ и функция $f(x)$,  которая дифференцируема в точке $x^\ast\in X$. Тогда, если $x^\ast$ — это локальный минимум, то
$$\langle\nabla f(x^\ast), x-x^\ast\rangle\ge 0, \forall x \in X$$
если $f(x)$ выпукла на $X$ и выполняется неравенство, то $x^\ast$ — глобальный минимум.


**теорема**

Пусть $f(x)$ определена на $X\subseteq \mathbb{R}^n$. Тогда, если $x^\ast$ — точка минимума $f(x)$ на $X$, то
$$0\in \partial_Xf(x^\ast)$$
если для некоторой точки $x^\ast\in X$ существует $\partial_Xf(x^\ast)$ и $0\in\partial_Xf(x^\ast)$, то $x^\ast$ точка минимума $f(x)$ на $X$.

### задача математического программирования

$$\min_{x\in\mathbb{R}^n}f(x)$$
$$\begin{aligned}
\text{s.t. } &g_i(x)\le 0, i=1, \ldots, m \\
&h_j(x)=0,j=1,\ldots, p
\end{aligned}$$
#### функция Лагранжа

$$L(x,\lambda,\mu)=f(x)+\sum_{i=1}^m\lambda_ig_i(x)+\sum^p_{j=1}\mu_jh_j(x)$$
где $\lambda\in\mathbb{R}^m_+,\mu \in \mathbb{R}^p$.

### условия Каруша-Куна-Таккера

**теорема ККТ**

Пусть для задачи математического программирования в точке $x^\ast\in X$, **справедливо условие регулярности**, $f(x)$, $g_i(x)$, $h_i(x)$ — дифференцируемы. Тогда, если $x^\ast$ — **локальный минимум**, то существуют $\lambda^\ast\in\mathbb{R}^m_+$  и $\mu\in \mathbb{R}^p$ такие, что выполнены следующие условия:

1. $\nabla_xL(x^\ast,\lambda^\ast,\mu^\ast)=0$ (условие стационарности)
2. $\lambda_i^\ast g_i(x^\ast)=0,\forall i=1,\ldots,m$ (условие дополняющей нежесткости)
3. $\lambda_i^\ast\ge0,\forall i=1,\ldots, m$ (условие неотрицательности)

**замечания**

1. ККТ — необходимое условие
2. $X$  — допустимое множество решений
3. $\lambda^\ast\in\mathbb{R}^m_+$ и $\mu^\ast\in\mathbb{R}^p$ — двойственные переменные или множители Лагранжа
4. все $\lambda^\ast_i$, отвечающие ограничениям неравенства обязательно неотрицательны:
$$\lambda_i^\ast\ge0$$


### условия регулярности

1. все ограничения $g_i(x)$, $h_i(x)$ — линейные функции
2. в точке $x^\ast$ градиенты всех **активных ограничений** линейно независимы
3. условие Слейтера

#### активные ограничения

Активные ограничения в точке $x^\ast\in X$ — это те, которые переходят в равенство в точке $x^\ast$, то есть все $h_j(x)$ и $g_i(x)$ для всех $i$, таких, что $g_i(x^\ast)=0$. 

#### условие Слейтера

1. задача является выпуклой (все $f$ и $g_i$ — выпуклые функции, $h_j$ — линейные функции) 
2. существует точка $x_0\in X$ такая, что $g_i(x_0)<0$ для всех $i$

**Пример, когда условие Слейтера не выполняется**
$$\min_{x\in\mathbb{R}}x$$
$$x^2\le 0$$
- задача выпуклая
- единственная точка $x^\ast=0$
- $L(x,\lambda)=x+\lambda x^2$
- $\nabla_x L(x^\ast,\lambda^\ast)=0$, $\nabla_x L=1+2\lambda x=0$
- не существует такого $\lambda^\ast\ge0$

### достаточные условия

#### первое условие

Если для стационарной точки $(x^\ast, \lambda^\ast, \mu^\ast)$ число активных ограничений равно $|J_A|=n$,  то есть 
$$|J_A|=p+|J_0|=n$$
где $|J_0|$  —  активные неравенства и $\lambda_i >0$.  Тогда точка $x^\ast$ — является точкой локального минимума.

#### второе условие

**теорема**

Если исходная задача является выпуклой, а для стационарной  точки $(x^\ast, \lambda^\ast, \mu^\ast)$ выполнены условия ККТ, то $x^\ast$ — точка глобального минимума.

## пример

1. проверка регулярности
2. составление функции Лагранжа
3. запись условий ККТ
4. поиск стационарных точек
5. проверка достаточных условий

## задача 1
$$\begin{cases}
\min(x_1-3)^2+(x_2-3)^2\\
x^2_1+x_2^2\le 5\\
x_1+2x_2=4
\end{cases}$$
условие Слейтера:
- задача выпукла
- находим точку, что ограничение типа неравенств становится строгим
$$x_0=(1,1), g(x_0)<0$$
записываем Лагранжиан
$$L=(x_1-3)^2+(x_2-3)^2+\lambda(x^2_1+x_2^2-5)+\mu(x_1+2x_2-4)$$
записываем условие ККТ
$$\nabla_x L=\begin{pmatrix}
2x_1-6+2\lambda x_1+\mu\\
2x_2-6+2\lambda x_2+2\mu
\end{pmatrix}$$
и приравниваем к нулю
$$\nabla_x L=\begin{pmatrix}
0\\
0
\end{pmatrix}$$
дополняющее
$$\lambda(x^2_1+x_2^2-5)=0$$
неотрицательость
$$\lambda\ge 0$$
рассматриваем два варианта, когда $\lambda=0$ и когда $(x^2_1+x_2^2-5)=0$

находим стационарные точки
$$(x^\ast,\lambda^\ast,\mu^\ast)=(2,1,0,2)$$ — глобальный минимум по второму достаточному условию, так как задача выпуклая, стационарная точка, которая соответствует условию теоремы ККТ.

## задача 2

Есть точка $x\in\mathbb{R}^n$ и необходимо спроецировать ее на множество $Q=\{y\in\mathbb{R}^n|l\le y\le r\}$.
Найти проекцию точки $x$ на множество $Q$.

Эту задачу можно переписать как
$$\begin{cases}
\min_y \frac{1}{2}||y-x||^2_2 \\
l\le y \le r
\end{cases}$$

все ограничения — линейные функции.

Лагранжиан
$$L=\frac{1}{2}||y-x||^2_2+\lambda_1^T(l-y)+\lambda^T_2(y-r), \lambda_1\ge0,\lambda_2\ge0$$
KKT
$$\begin{aligned}
y-x-\lambda_1+\lambda_2&=0\\
\lambda_{1i}(l_i-y_i)&=0\\
\lambda_{2i}(l_i-y_i)&=0\\
\lambda_1\ge0,\lambda_2&\ge0 \\
l\le y&\le r
\end{aligned}$$
первая строка — стационарность, вторая и третья — дополняющая нежесткость, четвертая — неотрицательность, последняя — допустимое множество