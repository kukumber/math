# блочное кодирование

В двоичном случае код — это некоторое подмножество $n$-ой декартовой степени множества, состоящего из 0 и 1:
$$C\subseteq\{0,1\}^n$$
Это множество каких-то слов длины $n$.

Пусть имеется поток двоичных данных произвольной природы и произвольной длины. Составим таблицу, в правом столбце которой будут все возможные кодовые слова, а в левом — можно выписать все возможные двоичные наборы длины $k$: от набора из всех нулей, до набора из всех единиц. Значение $k$ выбирается так, чтобы соблюдалось
$$2^k\le|C|$$
Кодовых слов хватит на то, чтобы каждый набор закодировать уникальным кодовым словом. При этом некоторые кодовые слова могут оказаться незадействованными.

Теперь разбиваем двоичные данные на блоки размера $k$, при этом неважно, сколько блоков получится, потому что с каждым блоком будем работать независимо.

По таблице каждый блок можно перекодировать в какое-то кодовое слово. При этом каждое слово становится размера $n$
![[неделя 03.png]]
и, если на вход приходило сообщение размера $N$, то оно становится размером $\frac{N}{k}\cdot n$, потому что каждому блоку размера $k$  было сопоставлено кодовое слово длиной $n$. Таким образом размер данных увеличился в $n/k$ раз.

Теперь данные представляют собой последовательности кодовых слов.

При выборе $k$ выгодно брать максимально возможное значение, тогда данные увеличатся минимально. То есть $k$ имеет порядок
$$k\approx\log_2|C|$$
тогда можно переписать:
$$\frac{N}{k/n}=\frac{N}{\frac{\log_2|C|}{n}}$$
Параметр $\frac{\log_2|C|}{n}$ называется **скоростью кода**, он всегда меньше или равен единице
$$\text{rate}(C):=\frac{\log_2|C|}{n}$$
**Относительное кодовое расстояние** $\delta(C)$ — это кодовое расстояние, поделенному на длину кодовых слов:
$$\delta(C):=\frac{d(C)}{n}$$
Относительное кодовое расстояние не может быть больше единицы.

## характеристики семейств кодов

Семейство кодов:
$$\tilde{C}=\{C_n\}_n^\infty=\ldots$$
то есть, для каждого $n$ возникает свое множество слов длины $n$, у которого есть свое кодовое расстояние и своя мощность.

Скорость кода (семейства кодов):
$$\text{rate}(\tilde{C}):=\lim_{n\to\infty}\frac{\log_2|C_n|}{n}$$
Относительное кодовое расстояние:
$$\delta(\tilde{C}):=\lim_{n\to\infty}\frac{d(C_n)}{n}$$
## вспомогательные утверждения о суммах биномиальных коэффициентов

**Утверждение**

При любом $r\le \frac{n}{2}$, выполнено неравенство
$$\sum_{k=0}^r\binom{n}{k}\le\frac{n^n}{r^r(n-r)^{n-r}}$$
**доказательство**

Возьмем произвольный параметр $t\le 1$:
$$t^{-r}(t+1)^n=t^{-r}\sum_{k=0}^n\binom{n}{k}t^k$$
занесем $t^{-r}$ под знак суммы и суммировать будем не до $n$, а до $r$ (отбросим часть слагаемых, от чего сумма не увеличится):
$$t^{-r}(t+1)^n=t^{-r}\sum_{k=0}^n\binom{n}{k}t^k\ge\sum_{k=0}^r\binom{n}{k}t^{k-r}$$
это позволяет избавиться от $t$, потому что эта величина меньше единицы, а $(k-r)<0$:
$$t^{-r}(t+1)^n=t^{-r}\sum_{k=0}^n\binom{n}{k}t^k\ge\sum_{k=0}^r\binom{n}{k}t^{k-r}\ge\sum_{k=0}^r\binom{n}{k}$$
Возьмем $t=\frac{r}{n-r}$. Так как $r\le \frac{n}{2}$, числитель окажется не больше, чем $n/2$, а знаменатель не меньше, чем $n/2$:
$$\sum_{k=0}^r\binom{n}{k}\le\bigg(\frac{n-r}{r}\bigg)^r\cdot\bigg(\frac{n}{n-r}\bigg)^n=\frac{n^n}{r^r(n-r)^{n-r}}$$

Удобно, когда параметры $r$ и $n$ стремятся к бесконечности и $r$ — это какая-то константная доля от $n$.

**Утверждение**

При $0<\delta<0.5$ имеем
$$\sum_{k=0}^{\delta n}\binom{n}{k}\le2^{n\cdot H(\delta)}$$
где функция энтропии, определенная для $x\in(0,1)$:
$$H(x)=-x\log_2 x-(1-x)\log_2(1-x)$$

**Замечание**
Важное замечание относительно оценки, доказанной в видеофрагменте: хотя это верхняя оценка, но она точна в смысле асимптотики логарифма, то есть при фиксированном $\delta\in\big(0, \frac{1}{2}\big)$ и стремящемся к бесконечности $n$ можно поставить знак асимптотического равенства «~» между левой и правой частью доказанного нами неравенства. 

## сравнение границ для (n,M,d)-кодов

Граница Синглтона 
$$M\le2^{n-d+1}$$
Если выразить ее через нормированные параметры и устремить $n$ к бесконечности, то
$$\frac{\log_2M}{n}\le\frac{\log_22^{n-d+1}}{n}=\frac{n-d+1}{n}=1-\frac{d-1}{n}=1-\delta+\frac{1}{n}$$

при $n$, стремящемся к бесконечности $\frac{1}{n}$ стремится к нулю и остается $1-\delta$, график которой:
![[неделя 03-1.png|w70]]
Фактически граница Синглтона говорит, что при $n$, стремящемся к бесконечности для любого кода его параметры, если их перевести в нормированный вид, будут лежать левее прямой на графике.

Граница Хемминга
$$M\le\frac{q^n}{|S_{\lfloor(d-1)/2\rfloor}(\mathbf{0})|}$$
если использовать нормированные параметры и устремить $n$ к бесконечности, то график будет:
![[неделя 03-2.png|w70]]

Граница Плоткина
$$M\le \bigg\lfloor\frac{d}{d-nr}\bigg\rfloor$$
если обобщить границу Плоткина и использовать нормированные параметры и устремить $n$ к бесконечности, то график будет:

![[неделя 03-3.png|w70]]

## вложение метрических пространств

**Метрическое пространство** — это множество с заданной на нем метрикой.

Примеры:
- $\big(\{0,1\}^n,d_X(\mathbf{a},\mathbf{b})\big)$ — метрическое пространство Хемминга
- $\big(\mathbb{R}^n,d_E(\mathbf{a},\mathbf{b})\big)$ — евклидово метрическое пространство

Вложение метрического пространства $U$ в метрическое пространство $V$ — это отображение $\varphi: U\to V$, сохраняющее метрику:
$$\text{dist}_U(x,y)=\text{dist}_V\big(\varphi(x),\varphi(y)\big)$$

Вложить пространство Хемминга в евклидово не выйдет. Однако, можно придумать отображение, которое, хотя и не будет сохранять отображение, но будет его модифицировать.

Сопоставим двоичному слову длины $n$ (вектору) $\mathbf{a}\in\{0,1\}^n$ вектор $\mathbf{x}^{\mathbf{a}}\in\mathbb{R}^n$ по правилу:
$$x_i^{\mathbf{a}}=\begin{cases}
1, &\text{if } a_i=1 \\
-1, &\text{if } a_i=0
\end{cases}$$
При этом
- $d_E(\mathbf{x}^{\mathbf{a}}, \mathbf{x}^{\mathbf{b}})=2\cdot\sqrt{d(\mathbf{a},\mathbf{b})}$ 
- $\langle \mathbf{x}^{\mathbf{a}}, \mathbf{x}^{\mathbf{b}}\rangle=n-2\cdot d(\mathbf{a},\mathbf{b})$ 
- $\|\mathbf{x}^{\mathbf{a}}\|=\sqrt{n}$ (здесь $\|\cdot\|$ — евклидова норма)

Все векторы лежат на сфере, потому что у них одинаковая евклидова норма.

### лемма о тупоугольной системе векторов

Пусть $\mathbf{y},\mathbf{x}_1,\ldots,\mathbf{x}_m\in\mathbb{R}^n$ таковы, что выполнено:
- $\langle\mathbf{x}_i,\mathbf{y}\rangle>0$ для $i=1, \ldots, m$ (то есть, острый угол)
- $\langle \mathbf{x}_i, \mathbf{x}_j\rangle\le0$ при $i\ne j$ (то есть прямой или тупой угол)

Тогда $x_1,\ldots,x_m$ линейно независимы и, в частности, $m\le n$.

**доказательство**

Возьмем линейную комбинацию векторов, которая равна нулю
$$c_1\mathbf{x}_1 +\ldots+c_m\mathbf{x}_m=0$$
Выделим два множества коэффициентов: положительные и отрицательные
$$\begin{aligned}
\text{Pos }:=\{i|c_i>0\} \\
\text{Neg }:=\{i|c_i<0\}
\end{aligned}$$
Цель: доказать, что эти множества пусты
$$\text{Pos } = \text{Neg } = \varnothing$$
Рассмотрим вектор $\mathbf{z}$, который равен части этой суммы, так как линейная комбинация равна нулю, то верно равенство:
$$\mathbf{z}:=\sum_{i\in\text{Pos}}c_i\mathbf{x}_i=\sum_{j\in\text{Neg}}(-c_j)\mathbf{x}_i$$
Домножим скалярно вектор $\mathbf{z}$ на вектор $\mathbf{y}$. Так как скалярное произведение линейно, то 
$$\langle\mathbf{z},\mathbf{y}\rangle=\bigg\langle\sum_{i\in\text{Pos}}c_i\mathbf{x}_i,\mathbf{y}\bigg\rangle=\sum_{i\in\text{Pos}}c_i\langle\mathbf{x}_i,\mathbf{y}\rangle$$
По условию леммы скалярное произведение каждого $\mathbf{x}_i$ на $\mathbf{y}$ строго положительно. По определению множества $\text{Pos}$ каждая $c_i>0$. Значит и вся сумма больше нуля.

Если скалярное произведение векторов больше нуля, значит каждый из векторов не нулевой.

Теперь рассмотрим вектор $\mathbf{z}$, не равный нулю, и распишем его скалярное произведение через скалярные произведения сумм
$$0<\langle\mathbf{z},\mathbf{z}\rangle=\bigg\langle\sum_{i\in\text{Pos}}c_i\mathbf{x}_i, \sum_{j\in\text{Neg}}(-c_j)x_j\bigg\rangle=$$
раскроем скобки
$$=\sum_{\substack{i\in\text{Pos}\\j\in\text{Neg}}}c_i(-c_j)\cdot\langle\mathbf{x}_i,\mathbf{x}_j\rangle\le0$$
$(-c_j)$ — положительная переменная, значит  $c_i(-c_j)$ тоже положительная, а скалярное произведение $\langle\mathbf{x}_i,\mathbf{x}_j\rangle$ не положительное, а значит и вся сумма меньше или равна нулю. А значит, мы получаем, что ноль слева неравенства строго меньше нуля. А это противоречие и значит множества пусты.

## Теорема Элайеса—Бассалыго

Для любого $(n, M, d)$-кода, где $d\le n/2$, выполнено неравенство
$$M\le\frac{n2^n}{|S_{\lfloor\tau n-1\rfloor}|}$$
где 
$$\tau=\frac{1-\sqrt{1-2\delta}}{2}$$
и $\delta=\frac{d}{n}$.

**доказательство**

Пусть $C$ — $(n,M,d)$-код,  и пусть $t\in \mathbb{N}$.

Положим $\deg_t C:=\max_{\mathbf{b}\in\{0,1\}^n}|C\cap S_t(\mathbf{b})|$ , то есть, степень кода относительно шаров радиуса $t$ — это максимум по всем двоичным словам количества кодовых слов, попадающих в шар радиуса $t$ с центром в слове $\mathbf{b}$.

Рассмотрим сумму
$$|C|\cdot|S_t|=\sum_{\mathbf{a}\in C}\sum_{\mathbf{b}\in\{0,1\}^n}\mathbb{1}_{d(\mathbf{a},\mathbf{b})\le t}$$
Сумма по всем кодовым словам $\mathbf{a}$ и по всем двоичным словам $\mathbf{b}$. Под знаком суммы стоит индикатор того, что расстояние между $\mathbf{a}$ и $\mathbf{b}$ оказалось не больше $t$. То есть, индикатор равен единице, когда пара близка и нулю в противном случае.

Если зафиксировать кодовое слово $\mathbf{a}$ и перебирать всевозможные двоичные слова $\mathbf{b}$, то внутренняя сумма будет равна количеству слов $\mathbf{b}$, которые попадают в шар радиуса $t$ с центром в слове $\mathbf{a}$. 

Вся сумма равна количеству слагаемых, умноженных на размер каждого слагаемого.

С другой стороны, сумму можно переписать, поменяв порядок суммирования
$$|C|\cdot|S_t|=\sum_{\mathbf{a}\in C}\sum_{\mathbf{b}\in\{0,1\}^n}\mathbb{1}_{d(\mathbf{a},\mathbf{b})\le t}=\sum_{\mathbf{b}\in\{0,1\}^n}\sum_{\mathbf{a}\in C}\mathbb{1}_{d(\mathbf{a},\mathbf{b})\le t}$$
Тогда внутренняя сумма при фиксированной константе $\mathbf{b}$ будет равна количеству кодовых слов $\mathbf{a}$, которые попадают в шар радиуса $t$ с центром в слове $\mathbf{b}$. Это количество не превосходит $\deg_t C$ по определению. Значит вся сумма не превосходит величины
$$\sum_{\mathbf{a}\in C}\mathbb{1}_{d(\mathbf{a},\mathbf{b})\le t}\le 2^n\cdot \deg_t C$$

Отсюда
$$M\le\frac{2^n\cdot \deg_tC}{|S_t|}$$
для любого $t\in\mathbb{N}$.

Когда мы оцениваем величину $\deg_t C$, мы берем шар некоторого радиуса и говорим, что в этот шар не может попасть слишком много кодовых слов. Все слова, которые могут попадать в шар, удалены от центра на какое-то небольшое расстояние, не больше радиуса шара. Между собой слова разнесены по крайней мере на кодовое расстояние. Получается аналогия с леммой о тупоугольной системе векторов.

Пусть есть центр шара $\mathbf{b}\in\{0,1\}^n$, и кодовые слова, попадающие в шар $\mathbf{a}_1,\ldots, \mathbf{a}_m \in C\cap S_t(\mathbf{b})$

Нам нужно доказать, что применима лемма о тупоугольной системе векторов $n \le m$.

Сопоставим словам $\mathbf{b},\mathbf{a}_1,\ldots, \mathbf{a}_m$ векторы $\mathbf{y},\mathbf{x}_1,\ldots, \mathbf{x}_m\in\mathbb{R}^n$
$$y_i=\begin{cases}
1/\sqrt{n}, & \text{if } b_i=1 \\
-1/\sqrt{n}, & \text{if } b_i=0
\end{cases}$$
Посмотрим на скалярные произведения каждого вектора $\mathbf{x}_i$ на вектор $\mathbf{y}$. Эти векторы были построены по векторам $\mathbf{b},\mathbf{a}_1,\ldots, \mathbf{a}_m$. Таким образом, можно пересчитать скалярное произведение геометрических векторов через хэммингово расстояние между исходными двоичными словами
$$\langle\mathbf{x}_i,y\rangle=\frac{1}{n}\big(n-2d(\mathbf{a}_i,\mathbf{b})\big)$$
здесь $1/\sqrt{n}$ выносится как $1/n$. Мы знаем, что расстояние Хэмминга $d(\mathbf{a}_i,\mathbf{b})$ не больше, чем $t$, потому что $\mathbf{a}_i$ лежит в шаре с радиусом $t$ в центре в точке $\mathbf{b}$, поэтому можно оценить снизу:
$$\langle\mathbf{x}_i,y\rangle=\frac{1}{n}\big(n-2d(\mathbf{a}_i,\mathbf{b})\big)\ge\frac{1}{n}(n-2t)$$
мы знаем, что $t:=\lfloor \tau n-1\rfloor$, поэтому $2t/n$ не больше, чем $2\tau$, а значит можно оценить снизу:
$$\langle\mathbf{x}_i,\mathbf{y}\rangle=\frac{1}{n}\big(n-2d(\mathbf{a}_i,\mathbf{b})\big)\ge\frac{1}{n}(n-2t)>1-2\tau$$
Если рассмотрим скалярное произведение $\mathbf{x}_i$ и $\mathbf{x}_j$, то оно точно так же рассчитывается через расстояние Хэмминга между словами $\mathbf{a}_i$ и $\mathbf{a}_j$
$$\langle\mathbf{x}_i,\mathbf{x}_j\rangle=\frac{1}{n}\big(n-2d(\mathbf{a}_i,\mathbf{a}_j)\big)$$
Так как расстояние между любыми двумя кодовыми словами не меньше, чем $d$:
$$\langle\mathbf{x}_i,\mathbf{x}_j\rangle=\frac{1}{n}\big(n-2d(\mathbf{a}_i,\mathbf{a}_j)\big)\le\frac{1}{n}(n-2d)$$
$d/n$ — это относительное кодовое расстояние $\delta$:
$$\langle\mathbf{x}_i,\mathbf{x}_j\rangle=\frac{1}{n}\big(n-2d(\mathbf{a}_i,\mathbf{a}_j)\big)\le\frac{1}{n}(n-2d)=1-2\delta$$
Получились наборы векторов:
- $\langle\mathbf{x}_i,\mathbf{y}\rangle>1-2\tau$ при всех $i$
- $\langle\mathbf{x}_i,\mathbf{x}_j\rangle\le1-2\delta$ при $i\ne j$

Если бы неравенства строились относительно нуля, то была бы в точности лемма о тупоугольной системе векторов.

Подправим векторы $\mathbf{y},\mathbf{x}_1,\ldots, \mathbf{x}_m$:
$$2\tau\mathbf{y},\big(\mathbf{x}_1-(1-2\tau)\mathbf{y}\big),\ldots, \big(\mathbf{x}_m-(1-2\tau)\mathbf{y}\big)$$
получаем, что скалярное произведение:
$$\begin{aligned}
\langle(\mathbf{x}_i-(1-2\tau)\mathbf{y}),2\tau\mathbf{y}\rangle=2\tau\langle\mathbf{x}_i,\mathbf{y}\rangle-2\tau(1-2\tau)\langle\mathbf{y},\mathbf{y}\rangle=
\end{aligned}$$
подставляем оценки
$$=2\tau\langle\mathbf{x}_i,\mathbf{y}\rangle-2\tau(1-2\tau)>0$$
Теперь посчитаем во что переходят $\mathbf{x}_i$ и $\mathbf{x}_j$
$$\begin{aligned}
&\big\langle(\mathbf{x}_i-(1-2\tau)\mathbf{y}),(\mathbf{x}_j-(1-2\tau)\mathbf{y})\big\rangle=\\
&=\langle\mathbf{x}_i, \mathbf{x}_j\rangle+(1-2\tau)^2\langle\mathbf{y},\mathbf{y}\rangle-(1-2\tau)\big(\langle\mathbf{x}_i,\mathbf{y}\rangle+\langle\mathbf{x}_j,\mathbf{y}\rangle\big)\le \\
&\le 1-2\delta+(1-2\tau)^2-2(1-2\tau)^2=-2(2\tau^2-2\tau+\delta)=0
\end{aligned}$$

Теперь можно применить лемму о тупоугольной системе. Получается, что подправленных $\mathbf{x}$ не больше, чем $n$. Это позволяет нам вернуться к началу доказательства. Кодовых слов, попадающих в шар радиуса $t$ не больше, чем $n$. Это означает, что степень кода $C$ относительно $t$ не больше $n$. Это дает нужный числитель дроби.