# совершенное паросочетание

Когда можно рассчитывать, что существует совершенное паросочетание в двудольном графе? 

Чтобы оно нашлось, точно должно быть одинаковое количество вершин в верхней и нижней долях $|V_1| = |V_2|$. Однако, этого условия недостаточно, например, если в графе слишком мало ребер, то совершенное паросочетание не существует.

Рассмотрим произвольное подмножество вершин $A$ в верхней доле
![[advanced_graphs_02_01.jpg|250]]
Рассмотрим все вершины в нижней доле, с которыми вершины множества $A$ смежны, то есть соседей $\mathcal{N}(A)$. Обязательно должно быть выполнено неравенство "множество соседей по мощности должно быть не меньше мощности множества $A$"
$$|\mathcal{N}(A)|\ge|A|$$
Если для всех подмножеств $A$ вершин верхней доли выполняется это условие, то совершенное паросочетание существует.

С алгоритмической точки зрения такой подход плох, потому что потребуется перебрать все возможные подмножества множества вершин верхней доли, а таких подмножеств $2^{|V_1|}$.

## теорема Холла

Условие
$$\forall A\subseteq V_1 \ |\mathcal{N}(A)|\ge|A|$$
является необходимым и достаточным для существования совершенного паросочетания в двудольном графе с равномощными долями $V_1$ и $V_2$.

Возьмем двудольный граф, для которого было проверено условие Холла и оно оказалось выполненым. Построим по этому графу специальную сеть, то есть ориентированный граф с двумя вершинами
![[advanced_graphs_02_02.jpg|400]]
Все ребра будут сориентированы сверху вниз. Будут добавлены источник $s$, из которого проведены дуги во все вершины верхней доли, и сток $t$, в который проведены дуги из всех вершин нижней доли.

Если для исходного двудольного графа выполнялось условие Холла, то для полученной сети будет оценка на пропускную способность разрезов. В такой сети не бывает узких разрезов, а это значит, что бывают большие потоки, а это значит, что можно построить искомое паросочетание.

Обозначим через $n$ мощность из каждой долей. Докажем, что при выполенении условия Холла, мощность минимального разреза будет равна $n$, то есть это значит, что в сети существует поток мощности $n$. Если исходные пропускные способности целочисленные, то этот поток можно выбрать целочисленным.

Пусть пропускные способности в этой сети будут равны 1. Пусть в сети нашелся поток величины $n$. Как доставить $n$ единиц продукта из $s$ в $t$? Это значит, что по каждой дуге, которая ведет из $s$ в верхнюю долю графа обязательно должна пойти единица продукта, иначе в общей сложности даже из $s$ не выйдет $n$ единиц продукта. Каждая дуга получается насыщенной. Точно так же по каждой дуге, ведущей в $t$ пойдет ровно одна единица продукта.

В каждую вершину верхней доли приходит ровно одна единица продукта, эта единица должна пойти вниз. Поскольку поток целочисленный, эта единица не дробится, а идет по какому-то фиксированному ребру. Получается поток величины $n$, по которому сразу можно выписать совершенное паросочетание для графа.

Разрез — это просто разбиение множества вершин сети на два подмножества $S$ и $T$ такое, что вершина $s$ оказывается в $S$, а $t$  — в $T$. 

В общем виде множество $S$ может выглядеть как объединение вершины $s$ с каким-то множеством вершин $S_1$ из верхней доли и  каких-то вершин $S_2$ из нижней доли
$$S= \{s\}\cup S_1 \cup S_2$$
Точно так же $T$ может выглядеть как объединение вершины $t$ с каким-то множеством вершин $T_1$ из верхней доли и  каких-то вершин $T_2$ из нижней доли
$$T= \{t\}\cup T_1 \cup T_2$$
![[advanced_graphs_02_03.jpg|200]]
Пропускная способность разреза — это суммарная пропускная способность тех дуг, которые ведут из вершин множества $S$ в вершины множества $T$. Это могут быть дуги, ведущие из $s$ в множество $T$ и попадающие в долю $V_1$, дуги, ведущие из $S_1$ в $T_2$ и дуги, ведущие из $S_2$ в $t$.

Число дуг из $s$ в $T_1$ равно мощности $|T_1|$, потому что в каждую вершину ведет ровно по одной дуге.

Число дуг из $S_2$ в $t$ равно мощности $|S_2|$, потому что из каждй вершины ведет ровно по одной дуге.
$$|T_1|+|S_2|+(\#S_1\to T_2)\le |V_1|$$
$V_1$ состоит из частей $T_1$ и $S_1$. Если перенести $|T_1|$ в правую часть неравенства, то останется $|S_1|$
$$|S_2|+(\#S_1\to T_2)\ge |S_1|$$По условиям Холла верно неравенство
 $$|\mathcal{N}(S_1)|\ge|S_1|$$
Так как из вершин множества $S_1$ выходят дуги и в $S_2$ и в $T_2$, поэтому верно неравенство
 $$|S_2|+(\#S_1\to T_2)\ge|\mathcal{N}(S_1)|$$
и в целом верно
 $$|S_2|+(\#S_1\to T_2)\ge|\mathcal{N}(S_1)|\ge|S_1|$$
а это доказывает, что величина разреза ограничена снизу величиной $|\mathcal{N}(S_1)|$. А это значит, что доказано существование совершенного паросочетания.

# k-связность

$k$-связный ($k$-вершинно-связный) граф — это граф, в котором для любой пары вершин найдутся $k$ соединяющих их путей без общих внутренних вершин.

$k$-реберно-связный граф — это граф, в котором для любой пары вершин найдутся $k$ соединяющих их путей без общих вершин.

Если граф является $k$-вершинно-связным, то это означает, что он и $k$-реберно-связный.

Для того, чтобы граф был $k$-связным, у него должна быть не менее, чем $k+1$ вершина. Потому что, какие бы две вершины ни были взяты, в графе должно найтись $k$ соединяющих их путей. 

Даже если две вершины 0 и 1 соединены ребром, все остальные пути имеют хотя бы одну промежуточную вершину.
![[advanced_graphs_02_04.png|400]]
В итоге, по крайней мере $k-1$ путь — не просто ребро, и еще две вершины 0 и 1, соединенные этими путями. Получается $k - 1 + 2 = k+1$ вершина обязана быть в графе, чтобы он мог называться $k$-связным графом.

Обычные связные графы — это частный случай $k$-связных графов при $k=1$.

Что происходит при удалении из графа вершины. Допустим, был исходный $k$-связный граф. Из этого графа удалено $l$ вершин. Получился некий новый граф, который будет по крайней мере $(k-l)$-связным. Потому что, если взять в этом графе произвольную пару вершин, то эта же пара вершин должна была существовать в исходном графе. В исходном графе между этими вершинами было по крайней мере $k$ путей. Часть этих путей могли проходить через множество удаляемых вершин $l$, но поскольку эти $k$ путей не пересекались по внутренним вершинам, то через множество $l$ проходило не более, чем $l$ этих путей. В получившемся графе осталось по крайней мере $(k-l)$ путей без изменений.

Понятие $k$ связности монотонно, то есть, если граф является $k$-связным, то он является и $(k-1)$-связным, $(k-2)$-связным и так далее.

## k-реберная связность

Если граф был $k$-реберно-связным и из него удаляется $l$ ребер, то аналогично $k$-связному графу, получается по крайней мере $(k-l)$-реберная связность. Если было $k$ путей, то, поскольку у них не было общих ребер, после удаления $l$ ребер останется по крайней мере $(k-l)$ путей.

# теорема Менгера

- Граф является $k$-вершинно-связным тогда и только тогда, когда чтобы сделать его несвязным или одновершинным, нужно удалить не менее $k$ вершин.
- Граф является $k$-реберно-связным тогда и только тогда, когда чтобы сделать его несвязным или одновершинным, нужно удалить не менее $k$ ребер.

Если граф исходно был $k$-вершинно связным, то это значит, что между каждой парой вершин существовало по крайней мере $k$ путей, не имеющих общих внутренних вершин. Тогда утверждается, что граф точно нельзя сделать несвязным, удалив менее, чем $k$ вершин. Потому что удаление, например, $(k-1)$ вершины сохранит по крайней мере один путь между парой вершин.

## доказательство реберного варианта

Возьмем произвольные вершины $s$ и $t$ в $k$-реберно-связном графе. В исходном графе заменим каждое ребро на две разнонаправленные дуги между теми же самыми вершинами. Все пропускные способности всех дуг будут равны 1. 

Допустим, что в сети есть разрез, который отделяет вершины $s$ и $t$, и имеет пропускную способность меньше $k$, допустим, $(k-1)$. Это означает, что общее количество дуг, ведущих из $S$ в $T$, не больше, чем $(k-1)$. 

Удалим в исходном графе ребра, по которым были построены дуги, дающие вклад в пропускную способность разреза. Тот факт, что в сети был взят разрез, приводит к тому, что граф, полученный удалением этих ребер, оказывается несвязным, то есть, между вершинами $s$ и $t$ не остается ни одного пути. Такого быть не может по условию, а значит разрезы оказываются пропускной способностью по крайней мере $k$. Значит между вершинами $s$ и $t$ существует поток, величина которого равна $k$.

Поскольку все пропускные способности равны 1, а поток целочисленный, то в каждую вершину либо приходит 1 единица и уходит 1 единица, либо он участвует в простом цикле, по которому ходит одна единица потока. Удалим из нашего потока все такие конструкции, так как они не влияют на величину потока. После удаления получается, что поток перекачивает $k$ единиц из $s$ в $t$. В этом потоке можно выделить $k$ непересекающихся по ребрам путей из $s$ в $t$.

Выделим произвольный путь из $s$ в $t$. По этому пути перекачивается поток величины 1, потому что все пропускные способности дуг равны 1. Уберем этот путь из сети. Если изначально поток был величины $k$, то теперь остался поток $(k-1)$. Так действуя последовательно, удаляя путь за путем, поток разбивается на $k$ непересекающихся по дугам путей.

## доказательство вершинного варианта

Допустим, у нас есть граф
![[advanced_graphs_02_05.png]]
по исходной вершине графа строится две новые вершины: одна из них будет отвечать за приход потока, а другая — за исход потока из данной вершины. Дуги направляем, руководствуясь наличием ребер в исходном графе:
![[advanced_graphs_02_06.png]]
- вершина $v$ графа $\to$ пара вершин: $v^-, v^+$
- ребро $uv$ графа $\to$ дуга в сети: $u^+v^-$
- всевозможные дуги вида $v^-v^+$

Теперь каждая вершина расщепилась на две. За счет того, что введена пара вершин, можно организовать пропускную способность. То есть, через каждую парную вершину можно пропустить максимум одну единицу.

Возьмем две вершины в исходной сети $s$ и $t$. В построенной сети с парными вершинами необходимо найти поток из вершины $s^+$ в вершину $t^-$.  Из $s^+$ может выходить несколько дуг, в $t^-$ может заходить несколько дуг. Рассмотрим минимальный по пропускной способности разрез. Этот разрез содержит множества $S$ и $T$.

Допустим, есть вершина $v^-$ в множестве $T$ и есть какая-то дуга, ведущая через разрез в эту вершину из вершины $w^+$. Если переместить вершину $v^-$ во множество $S$, то дуга $w^+\to v^-$ перестанет вносить вклад в пропускную способность разреза, однако, если вершина $v^+$ остается во множестве $T$, то дуга $v^-\to v^+$ станет приносить единицу в пропускную способность разреза.

Если все вершины со знаком $-$ перенести во множество $T$, а со знаком $+$ в $S$ ($s^+$ и $t^-$ остаются на своих местах), то пропускная способность разреза не будет увеличена.

Допустим, в результате таких операций пропускная способность разреза оказалась меньше, чем $k$, например, $(k-1)$. Тогда это означает, что не более, чем $(k-1)$ дуга идет из множества $S$ в $T$. Так как вершины были перенесены, то в этом разрезе каждая дуга ведет из минусовой вершины в плюсовую, соответствующую той же букве. Каждой такой дуге можно сопоставит вершину в исходном графе с той же буквой. 

Если взять множество вершин, которые соответствуют дугам разреза, и удалить его из исходного графа, граф потеряет связность. Так как разрез обладает тем свойством, что любой путь из $S$ в $T$ проходит через одну из выделенных вершин. Значит, если пропускная способность разреза меньше $k$, граф теряет связность при удалении меньше, чем $k$ вершин, что не должно происходить, значит в сети пропускные способности разрезов ограничены величиной $k$. Значит существует поток величины $k$, а значит можно построить множество из $k$ не пересекающихся по вершинам путей. Это помогает сделать тот факт, что дуги между вершинами с разными знаками имеют пропускную способность 1.

# свойства k-связных графов

## свойство 1

Если графы $G'$ и $G''$ являются $k$-связными и имеют не менее $k$ общих вершин, то граф $G'\cup G''$ является $k$-связным.

Допустим мы удаляем $(k-1)$ вершину, какая-то часть из них окажется в $G'$, какая-то в $G''$, а еще какая-то часть среди вершин, по которым графы были соединены.

Возмьем пару вершин $s$ и $t$, которые не были удалены, из одного и того же графа, например $G'$. Так как из графа $G'$ было удалено не больше, чем $(k-1)$ вершина, значит граф $G'$ внутри себя остался связным. Значит можно найти путь между $s$ и $t$.

Если взять одну вершину из одного графа, вторую — из другого, то можно взять хотя бы одну вершину из тех, по которым графы были склеены, потому что хотя бы одна такая вершина осталась. Пусть это будет вершина $v$. Вершины $s$ и $v$ лежат в графе $G'$, между ними существует путь, целиком лежащий в графе $G'$. Вершины $v$ и $t$ лежат в графе $G''$, между ними существует путь, целиком лежащий в графе $G''$. Из этих двух путей получается путь, соединяющий вершины $s$ и $t$. Так что, какая бы пара вершин ни была взята, между ними будет путь. Значит полученная конструкция является $k$-связной.

## свойство 2

Если к $k$-связному графу добавить новую вершину и соединить ее с любыми $k$ вершинами графа, полученный граф будет также $k$-связным.

Допустим, добавили вершину $v$. Если из полученной конструкции удалить множество из $(k-1)$ вершины, принадлежащих исходному графу, то внутри исходного графа между любой парой вершин остается хотя бы один путь. Останется также и путь между любой вершиной и новой вершиной $v$.

## лемма о веере

В $k$-связном графе для любых различных вершин $u, v_1, v_2, \ldots, v_k$ существует $k$ не пересекающихся по внутренним вершинам путей из $v$ в $v_i(i=1\ldots k)$.

Добавим временно в граф новую вершину $v_{new}$, и эту вершину соединяем ребрами с $v_1, v_2, \ldots, v_k$. Полученная конструкция является $k$-связной, а значит существует $k$ не пересекающихся по внутренним вершинам путей из $u$ в $v_{new}$. Эти пути проходят через вершины $v_1, v_2, \ldots, v_k$.

## теорема

В $k$-связном графе для любых $A,B\subseteq V$, таких, что $A\cap B=\varnothing$ и $|A|=|B|=k$, найдутся $k$ не пересекающихся по вершинам путей из $A$ в $B$.

Доказывается по предыдущей лемме, но с двумя новыми вершинами, которые прикрепляются к вершинам из множества $A$ и $B$.

# циклы в k-связных графах

**Теорема**

Для любого $k\ge 2$ в любом $k$-связном графе для любых $v_1,\ldots,v_k\in V$ существует простой цикл, содержащий $v_1,\ldots, v_k$.

**Доказательство**

Индукцией по $k$:
При $k=2$ уже доказано.

Пусть $k\ge3$ и для $(k-1)$-связных графов утверждение теоремы выполнено.

Возьмем $k$-связный граф $G$ и произвольные вершины в нем. Временно забудем про вершину $v_k$. Если в $k$-связном графе $G$ удалить одну вершину, то связность графа уменьшится не более, чем на единицу.

Тогда к этому графу можно применять предположение индукции, и считать, что у него есть цикл $C$, содержащий вершины $v_1,\ldots, v_{k-1}$ и этот цикл без самопересечений. Этот цикл точно не содержит вершину $v_k$. Без ограничения общности можно считать, что вершины в этом цикле идут по порядку.

Вначале рассмотрим случай, когда $V(C) = \{v_1,\ldots,v_{k-1}\}$.  То есть на этом цикле нет никаких вершин, кроме перечисленных. Тогда, если у графа $G$ удалить вершины $\{v_3,\ldots,v_{k-1}\}$, таких вершин оказывается всего $(k-3)$. Оставшийся граф по крайней мере двусвязный. Значит в этом графе для пары вершин $v_1$ и $v_2$ можно отыскать путь, проходящий через третью вершину $v_k$. Объединив эту цепь  с $(C-v_1v_2)$, получаем нужный цикл.

Теперь рассмотрим случай, когда в цикле есть вершина $u\in V(C)\backslash \{v_1,\ldots, v_k\}$. По лемме о веере в $G$ есть $k$ не пересекающихся по внутренним вершинам путей из $v_k$ в каждуй из вершин $u, v_1, \ldots, v_{k-1}$.

Рассмотрим отрезки этих путей от $v_k$ до первого пересечения с циклом. Тогда получается, что есть $k$ путей из вершины $v_k$ в разные точки цикла.

Всего таких отрезков путей $k$ штук, а вершины $v_1, \ldots, v_{k-1}$ разбивают цикл на $(k-1)$ интервалов.

По принципу Дирихле найдется интервал, на который попали концы двух отрезков.

Из этой пары отрезков и части цикла через $v_1, \ldots, v_{k-1}$ строится искомый цикл $v_1, \ldots, v_{k}$.

# блоки и точки сочленения

Точка сочленения графа — это вершина, удаление которой делает граф несвязным.

Блок в графе — это максимальный связный подграф без точек сочленения (т. е. блок — это "компонента двусвязности" графа).

Любые два блока имеют не более одной общей точки (если она есть, то это точка сочленения).

Любой простой цикл лежит в графе в пределах одного блока.

Получающаяся ациклическая конструкция — это BC-дерево (BC block cutvertex).

Каждому связному графу можно поставить в соответствие его BC-дерево.

Вершины BC-дерева соответствуют блокам и точкам сочленения.

Между вершинами $b$ и $c$ BC-дерева проводится ребро, если соответствующая точка $c$ сочленения принадлежит соответствующему блоку $b$ графа.

Листья BC-дерева всегда соответствуют блокам графа. Такие блоки называются концевыми. Концевые блоки имеют с оставшейся частью графа только одну общую вершину.

Во всяком дереве не меньше двух листьев, значит, если граф связный, но не двусвязный, то в нем не меньше двух концевых блоков.
