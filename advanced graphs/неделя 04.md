# задача Турана

Представим, что есть несколько вершин, между которыми нет связей. Мы начинаем между этими вершинами создавать связи, добавляя ребра в граф. Рано или поздно граф станет полным, но есть промежуточные моменты, от пустого графа, до полного, когда начинают возникать полные подграфы. Сколько нужно добавить в граф ребер, чтобы неизбежно появился треугольник?

Есть две эквивалентные постановки такой задачи:
- Сколько ребер должно быть в графе на $n$ вершинах, чтобы он наверняка содержал клику на $k$ вершинах?
- Как много ребер может быть в графе на $n$ вершинах, не содержащем клику на $k$ вершинах?

## теорема Турана

Пусть есть граф $G$ на $n$ вершинах. 

- $|G|=n$
- $\omega(G)\le k$ (кликовое число не превосходит $k$)
- $G$ имеет наибольшее число ребер

Пусть кликовое число $\omega(G)\le k$. Пусть граф $G$ экстремален, то есть обладает наибольшим числом ребер среди всех графов, удовлетворяющих первым двум свойствам. Тогда граф $G$ является полным $k$-дольным графом, в котором мощности любых двух долей отличаются не более, чем на 1.

### доказательство

Сначала доказываем, что кликовое число графа $G$ на самом деле равно $k$. В формулировке теоремы граф должен быть таким, чтобы кликовое число не превышало $k$. Нужно доказать, что раз этот граф с максимальным количеством ребер, то размер клики в точности равен $k$. 

Если бы исходно граф был с кликовым числом строго меньше $k$, то тогда можно найти в графе произвольную пару вершин, которые не соединены ребром и это ребро провести. То есть перейти к графу $G'$, который отличается от $G$. Тогда в графе $G'$ кликовое число не может быть больше $k$, потому что при проведении одного ребра в графе кликовое число не может увеличиться больше, чем на 1. Это противоречило бы экстремальности графа $G$, так как по определению он выбран таким, чтобы нельзя было добавить к нему ребер, без нарушения двух свойств.

Докажем, что граф $G$ — полный $k$-дольный граф при помощи леммы о тройке вершин. Для любых трех вершин $u,v,w$ графа $G$, если вершины $uv$, $vw$ не смежны друг с другом, то и вершины $uw$ тоже не смежны друг с другом.

Предположим, что такая тройка вершин оказалась в графе и тогда можно показать, что на самом деле граф не был экстремальным. Значит в нем можно было увеличить чило ребер, не портя граф с точки зрения кликового числа и числа вершин.

Допустим, что $uv, vw \notin E(G)$ и $uw\in E(G)$. Рассмотрим все возможные случаи.

#### случай 1
Когда $d(v)<d(u)$. 

Преобразуем граф следующим образом:
![[advanced_graphs_04_01.png|w80]]
Перейдем от графа $G$ к графу $G'$, в котором вершины никак не увеличиваются и не уменьшаются, но ребра будут локально изменены: все ребра из вершины $v$ удалим и перенаправим в соседей вершины $u$. То есть, забываем, кто были соседями вершины $v$ и вершина $v$ копирует соседей с множества соседей вершины $u$.

Заметим, что такое преобразование ничего не портит с точки зрения кликового числа. Если исходно кликовое число графа $G$ было равно $k$, может ли возникнуть клика размера $k+1$ в графе $G'$? Если такая клика отыскалась, то возможно несколько вариантов:

1. Эта клика находится в нижней части графа $G'$, то есть она не включает вершины $u,v,w$. Но эта часть не менялась по отношению к графу $G$, значит ту же самую клику размера $k+1$ можно отыскать в исходном графе $G$. Это противоречие.
2. Эта клика может содержать какие-то вершины $u$ и $w$. Поскольку множество соседей $u$ и $w$ никак не меняется, то, если клика нашлась в $G'$, то ее можно отыскать и в $G$. Это противоречие.
3. Эта клика содержит вершину $v$ и одну из вершин $u$ или $w$. Тогда она не может содержать одновременно $u,v$ и $w$, потому что вершины не смежны и одновременно в клику попасть не могут. Допустим, эту клику отыскали. Поскольку множество соседей вершины $v$ совпадает с множеством соседей вершины $u$ в графе $G'$, это означает, что, если вернуться обратно к графу $G$ и в этой найденной клике $k+1$ заменить вершину $v$ на вершину $u$, то есть, рассмотрим те же самые вершины в нижней части, вершину $w$ и вместо вершины $v$ в клику включим вершину $u$. Полученный подграф должен быть кликой размера $k+1$. Это противоречие.

#### случай 2

Когда $d(v)<d(w)$ аналогичен случаю 1.

#### случай 3

Когда $d(v)\ge d(u)$ и $d(v)\ge d(w)$.

Преобразуем граф следующим образом
![[advanced_graphs_04_02.png|w80]]
Удалим все ребра вершин $u$ и $w$, и копируем окрестности вершины $v$. Получается такая же схема, как в предыдущих случаях, если клика размера $k+1$ может быть найдена в $G'$, то ее же можно отыскать и в $G$. А это противоречие. Число ребер увеличивается, потому что было удалено количество вершин $(d(u)+d(w)-1)$, а прибавлено $2\times d(v)$. Поскольку выполнены неравенства условия, то получается как минимум на 1 больше ребер в $G'$, чем в $G$.

Получается, что предположение о существовании $uv, vw \notin E(G)$ и $uw\in E(G)$ неверно.

Таким образом, доказано, что отношения несмежности вершин *транзитивны*. 

Очевидно, что отношения *рефлексивны*, то есть, никака вершина сама с собой несмежна, так как у графа нет петель.

Очевидно, что отношения *симметричны*, то есть, если $u$ и $v$ несмежны, то и $v$ и $u$ также несмежны.

Отношение эквивалентности позволяет множество объектов разбить на непересекающиеся подмножества, которые называются *классами эквивалентности*. Если пара объектов берется из одного и того же класса, то они эквивалентны. Если из разных классов — не эквивалентны. В нашем случае классы эквивалентности — это независимые множества вершин, на которые разбивается граф. Если две вершины берутся из одного класса эквивалентности, то они несмежны. Если из разных классов — смежны. То есть, это в точности определение *полного многодольного графа*.

Структуру графа можно вывести не ссылаясь на классы эквивалентности. Возьмем исходный граф $G$ и пару несмежных вершин $u$ и $v$. Допустим, что какая-то вершина $w$ оказывается несмежной с вершиной $u$. Тогда по транзитивности вершина $w$ несмежна с $u$, и с $v$. Какую бы другую вершину $t$ мы не взяли, если эта вершина оказывается не связана ребром хотя бы с одной из вершин $u,v,w$, то по транзитивности можно вывести, что эта вершина ни с одной другой вершиной из перечисленных тоже не связана.

Так можно продолжать выбирать вершины на основе принципа: если вершина оказывается несмежной с какой-либо из уже выбранных, значит она точно несмежна ни с одной из выбранных и ее можно добавить в множество уже выбранных вершин. Операция повторяется до тех пор, пока можно хотя бы одну вершину добавить в множество. Как только произошла остановка, отделяем множество от остального графа. В этом множестве любая пара вершин является несмежной, а любая вершина, не лежащая в этом множестве, должна быть связана со всеми вершинами этого множества. То есть это одна из долей полного $k$-дольного графа. 

Можно повторить с оставшейся частью графа тот же самый процесс и сформировать следующую долю. Так повторять до тех пор, пока граф не будет разбит на доли.

Осталось доказать, что граф не просто полный $k$-дольный, а мощности долей почти равные.

![[Pasted image 20230613075917.png|w50]]
Допустим, что граф полный многодольный, но какие-то две доли сильно отличаются по мощности, например их мощность $n_1$ и $n_2$, и $n_1\ge n_2+2$. Можно локально поменять граф: взять вершину из большей доли и перенести в долю мощности $n_2$. 

При этом, очевидно, нужно убрать у этой вершины все ребра, которые шли в долю $n_2$ и добавить все ребра, идущие из нее в долю $n_1$. Все остальные доли графа не претерпели никаких изменений. Все ребра, которые шли из $n_1$ и $n_2$ в оставшуюся часть графа, не изменились. 

У вершины было удалено $n_2$ ребер и было добавлено $n_1-1$ ребер. Тогда $n_2+(n_1-1) >0$. То есть, с помощью простого перетаскивания вершины было увеличено количество ребер в графе. Это противоречит экстремальности исходного графа $G$. 

# теорема Эрдёша—Стоуна

Каково максимальное число ребер в графе на $n$ вершинах, не содержащем заданного подграфа $H$?

Обозначение максимального числа ребер, которых все еще не хватает для получения графа $H$: $ex_H(n)$

В теореме Турана количество ребер можно прикинуть следующим образом. Если кликовое число не превышает $r$, то размер одной доли будет $n/r$, выбрать пару долей, между которыми проводить ребра $C_r^2$ способами. Каждая пара долей даст $(n/r)^2$ ребер.
$$C_r^2\cdot\bigg(\frac{n}{r}\bigg)=\frac{n^2r(r -1)}{r^2\cdot2}=\frac{n^2}{2}\cdot\frac{r-1}{r}$$
## теорема

Каким бы ни был фиксированный граф $H$ при $n\to \infty$ максимальное число ребер, которые можно накинуть на $n$ вершин так, чтобы не появлялся подграф $H$, поделенное на число ребер в полном графе на $n$ вершинах стремится к отношению хроматического числа графа $H$ минус 2 к хроматическому числу графа $H$ минус 1
$$\frac{ex_H(n)}{n(n-1)/2}\to\frac{\chi(H)-2}{\chi(H)-1}$$
Когда граф $H$ двудольный, то в числителе справа появляется ноль.

### лемма

Для любых $r, t \in \mathbb{N}$ и для любого $\varepsilon\in \big(0, \frac{1}{r}\big)$ при всех достаточно больших $n$ в любом графе на $n$ вершинах с $\big(1-\frac{1}{r}+\varepsilon\big)\cdot\frac{n^2}{2}$ ребрами найдется полный $(r+1)$-дольный подграф, в котором мощность каждой доли не меньше $t$.


#### доказательство леммы

База индукции: $r=1$ — однодольный подграф, в котором вершины составляют одно независимое множество.

Индуктивный переход. Предположим, что для $r,t,\varepsilon$ утверждение теоремы имеет место. Докажем для $r+1$.

Возьмем граф $G$ и сначала отыщем большой подграф $G'$, в котором большая минимальная степень вершин. В этом подграфе отыщем полный $r$-дольный подграф.

**ищем подграф с большой $\delta$**

Возьмем исходно $G'$, совпадающий со всем $G$

Если в графе $G$ есть вершина, которая содержит мало ребер, удалим ее
$$\deg v<\bigg(1 - \frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot|G'|$$
пусть процесс завершился и $|G'|=n'$.

Тогда количество ребер, которые мы удалили из $G$:
$$\begin{aligned}
\le\sum_{k=n'+1}^n\bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot k &= \bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg) \cdot\frac{(n-n')(n+n'+1)}{2} \le\\
& \le \bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot\frac{n^2-n'^2}{2}\cdot\frac{n-n'}{2}
\end{aligned}$$
Мы пришли к графу на $n'$ вершинах, количество ребер в котором не менее, чем
$$\begin{aligned}
&||G||-\bigg[\bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot\frac{n^2-n'^2}{2}\cdot\frac{n-n'}{2}\bigg]\ge \\
& \ge\bigg(1-\frac{1}{r}+\varepsilon\bigg)\cdot\frac{n^2}{2}- \bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg) \cdot\frac{n^2-n'^2}{2}\cdot\frac{n-n'}{2}= \\
& = \frac{\varepsilon}{2}\cdot\frac{n^2}{2}+\bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot\frac{n'^2}{2}-\frac{n-n'}{2}
\end{aligned}$$
удаленное число вершин
$$\frac{n'^2}{2}\ge\frac{\varepsilon}{2}\cdot\frac{n^2}{2}+\bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot\frac{n'^2}{2}-\frac{n-n'}{2}$$
из этого неравенства можно получить следующее
$$\bigg(\frac{1}{r}-\frac{\varepsilon}{2}\bigg)\cdot n'^2-n'\ge\frac{\varepsilon n^2}{2}-n$$
избавившись от $n'$
$$n'^2\ge\frac{\varepsilon n^2}{2}-n$$
с ростом $n$ растет и $n'$.

Итак, по предположению выполнено
$$\delta(G)\ge\bigg(1-\frac{1}{r}+\frac{\varepsilon}{2}\bigg)\cdot|G|$$
введем параметр
$$\hat t:=\lceil4t/\varepsilon\rceil$$
Количество ребер в $G$ не менее
$$\frac{1}{2}\cdot|G|\cdot\delta(G)>\frac{|G|^2}{2}\cdot\bigg(1-\frac{1}{r-1}+\frac{\varepsilon}{2}\bigg)$$
По предположению индукции при достаточно больших $|G|$ в графе $G$ найдется полный $r$-дольный подграф с долями $A_1,\ldots,A_r$, где $\forall i \ |A_i|=\hat t$.

Обозначим через $A$ все оставшиеся вершины графа
$$A:=V(G)\backslash(A_1\cup\ldots\cup A_r)$$
и введем множество хороших вершин $A_\text{good}$ — это те вершины, которые не лежат в  $r$-дольном подграфе и такие, что из такой каждой вершины ведет по крайней мере $t$ ребер в каждую из долей $A_i$
$$A_\text{good}:=\{v\in A |\forall i \ |N(v)\cap A_i|\ge t\}$$
Количество пар несмежных вершин таких, что одна берется из множества $A$, а другая — из одной из долей
$$A\times(A_1\cup\ldots\cup A_r)$$
таких ребер будет с одной стороны меньше, чем
$$\begin{aligned}
&\le |A_1\cup\ldots\cup A_r|\cdot\big(|G|-\delta(G)\big)\le r\hat t\cdot\bigg(\frac{1}{r}-\frac{\varepsilon}{2}\bigg)\cdot|G|
\end{aligned}$$
с другой стороны
$$\ge \big(|A|-|A_\text{good}|\big)\cdot(\hat t - t)=\big(|G|-r\hat t- |A_\text{good}|\big)\cdot(\hat t - t)$$
имеем
$$\big(|G|-r\hat t-|A_\text{good}|\big)\cdot(\hat t-t)\le r\hat t\bigg(\frac{1}{r}-\frac{\varepsilon}{2}\bigg)\cdot|G|$$
отсюда
$$|A_\text{good}|\ge\frac{\bigg(\frac{\varepsilon}{2}\cdot r\hat t-t\bigg)\cdot|G|-r\hat t(\hat t-t)}{\hat t -t}\ge\frac{t\cdot|G|-r\hat t^2}{\hat t}$$
Мы доказали, что можно как-то оценить снизу количество вершин графа, из которых ведет много ребер в каждую из долей $r$-дольного подграфа. Из этого множества вершин можно набрать $( r + 1)$ долю, которая нужна для индуктивного перехода.

Когда число вершин растет, число хороших вершин тоже растет.  Возьмем настолько большой граф, что число вершин больше следующей величины:
$$|A_\text{good}|>
(C_\hat t^t)^r\cdot(t-1)$$
Поубираем некоторые ребра из графа $G$. Если какая-то вершина $v$ имеет больше, чем $t$ соседей в одной из долей, тогда берем и удаляем соответствующее ребро. Это позволит перейти от неравенства к равенству
$$A_\text{good}:=\{v\in A |\forall i \ |N(v)\cap A_i|= t\}$$
Найдется по крайней мере $t$ вершин, у которых распределение соседей среди долей $A_i$ абсолютно одинаковое. По принципу Дирихле получается, что найдется по крайней мере $t$ вершин в множестве $A_\text{good}$,  у которых одинаковое распределение соседей. Это означает, что каждая из этих вершин соедина с одними и теми же вершинами во множестве $A_1$, во множестве $A_2$ и т. д. 

Получается, что в каждом множестве $A_i$ найдено $t$ вершин.

Индуктивный переход тем самым завершен.

### доказательство теоремы

Переформулировка теоремы. Для любого фиксированного графа $H$ и любого $\varepsilon >0$ при всех достаточно больших $n$ в любом $n$-вершинном графе $G$, таком, что
$$||G||\ge\bigg(1-\frac{1}{\chi(H)-1}+\varepsilon\bigg)\cdot\frac{n^2}{2}$$
найдется подграф, изоморфный $H$.

С другой стороны, найдется $n$-вершинный граф с числом ребер 
$$\ge\bigg(1-\frac{1}{\chi(H)-1}-\varepsilon\bigg)\cdot\frac{n^2}{2}$$
в котором нет подграфов, изоморфных $H$.

Рассмотрим полный $(\chi(H)-1)$-дольный граф $G$, в котором каждая доля имеет размер $\sim\frac{|G|}{\chi(H)-1)}$

В этом графе можно оценить количество ребер
$$||G||\sim C_{\chi(H)-1}^2\cdot\bigg(\frac{|G|}{\chi(H)-1}\bigg)^2=\frac{|G|^2}{2}\cdot\frac{\chi(H)-2}{\chi(H)-1}$$
В этом графе не может быть подграфа $H$, потому что он имеет некое хроматическое число, которое больше, чем хроматическое число графа $G$.

Теперь возьмем граф, в котором на $\varepsilon$ больше ребер, чем говорится в теореме. 
$$||G||\ge\bigg(1-\frac{1}{\chi(H)-1}+\varepsilon\bigg)\cdot\frac{|G|^2}{2}$$
Тогда в таком графе найдется подграф $H$.

Возьмем в основной лемме в качестве $r=\chi(H)-1$, $t=|H|$. Тогда, согласно лемме, при большом количестве вершин графа $G$ можно отыскать $\chi(H)$-дольный подграф, у которого мощность каждой доли будет равна числу вершин $|H|$.

