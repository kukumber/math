# раскраски вершин и ребер

Под раскраской вершин графа $G$ мы понимаем произвольное отображение множества вершин графа в какое-то конечное множество
$$\phi:V(G)\to \{1,2,\ldots, k\}$$
Раскраска называется **правильной**, если для любых двух вершин графа, которые соединены ребром, цвета, сопоставленные этим вершинам, разные
$$\forall v'\forall v''\big(v'v''\in E(G)\Rightarrow\phi(v')\ne\phi(v'')\big)$$
пример **правильной** раскраски графа в три цвета:
![[advanced_graphs_05_01.png|w50]]
**Хроматическое число** $\chi(G)$ — это минимальное число цветов, в которое можно правильно раскрасить вершины графа $G$.

## списочное хроматическое число

Изначально понятие раскраски говорит, что исходно есть общий набор цветов для всего графа. Понятие списочной раскраски говорит, что для каждой вершины графа приписано свое множество цветов. То есть, вводится понятие списков цветов.

Пусть для каждой вершины $v$  графа $G$ указан конечный список $L_v\subseteq \mathbb{N}$ — цвета, в которые разрешается красить вершину $v$. 

**Правильная списочная раскраска** графа $G$ (для набора списков $\{L_v\}_{v\in V(G)}$) — это отображение $\phi:V(G)\to\mathbb{N}$, которое
- является правильной раскраской в обычном понимании
- каждая вершина покрашена в цвет из своего списка $\phi(v)\in L_v$

**Списочное хроматическое число** графа $G$ — это такое минимальное $k$, что правильная списочная раскраска $G$ существует для *любого* набора списков $\{L_v\}_{v\in V(G)}$, удовлетворяющего условию $\forall v|L_v|=k$. Обозначается $\chi_l(G)$
$$\chi_l(G)\ge\chi (G)$$
Допустим дан граф и для него известно, что списочное хроматическое число равно $k$, это означает, что можно гарантировать правильную раскраску графа, какие бы списки размера $k$ ни были предъявлены для вершин. При этом, если все списки для всех вершин совпадают и их мощность равна $k$, то это равносильно раскраске графа в $k$ цветов.

Пример графа, для которого неравенство строго $\chi_l(G)>\chi(G)$ 
![[advanced_graphs_05_02.png|w50]]
хроматическое число этого графа равно 2, а списочное хроматическое число — строго больше 2. В этом графе правильной раскраски в цвета из списков не существует.

## теорема

При любом $k\in\mathbb{N}$ существует граф $G$, для которого $\chi(G)=2$ и $\chi_l(G)>k$.

То есть, теорема утверждает, что списочное и обычное хроматические числа могут отличаться во сколько угодно раз.

Возьмем полный двудольный граф, у которого в верхней и в нижней долях достаточно много вершин $C_{2k-1}^k$. Вершинам верхней доли припишем все возможные подмножества множества натуральных чисел от 1 до $2k-1$. Сделаем тоже самое с вершинами нижней доли: припишем им всем $k$-элементные подмножества множества первых $2k-1$ чисел. Покажем, что данный конкретный граф с данными списками нельзя правильно раскрасить так, чтобы у каждой вершины цвет был выбран из ее списка. Поскольку мощности всех этих списков равны $k$, хроматическое списочное число у графа строго больше $k$. Если бы оно было равно $k$, то для любого набора списков мощности $k$ мы должны были бы уметь раскрашивать граф.
![[advanced_graphs_05_03.png|w50]]

Предположим, что граф покрашен. В верхней доле графа встречается множество цветов $|A|$. Заметим, что мощность множества не меньше, чем $k$. Если бы мощность была не больше $k-1$, то тогда мощность $|\{1,\ldots,2k-1\}\backslash A|\ge k$. Тогда из этого неравенства следовало бы, что, поскольку среди вершин верхней доли среди их списков встречаются все возможные $k$-элементные подмножества, то какое-то из этих множеств не будет пересекаться с множеством $A$. Этого быть не может, следовательно, $|A|\ge k$.

Посмотрим на вершины нижней доли. Поскольку среди вершин нижней доли среди списков встречаются все возможные $k$-элементные множества, значит какое-то из этих множеств целиком содержится в $A$, а это означает, что есть вершина нижней доли, список цветов для которой целиком содержится в $A$. Это означает, что невозможно выбрать для этой вершины цвет, которого нет у ее соседей.

## оценка $\chi_l(G)$ сверху через $\chi(G)$

Для любого графа $G$ выполнено неравенство
$$\chi_l(G)\le\lceil\chi(G)\cdot\ln|G|\rceil$$
Пусть есть произвольный граф $G$, у которого обычное хроматическое число $\chi(G)=\chi$. Нужно показать, что, какими бы ни были списки на вершинах графа, если размер каждого списка $\lceil \chi \ln|G|\rceil$, можно всегда при любых списках выбрать из каждого списка цвет так, чтобы все ребра графа имели бы на концах ребра разных цветов.

Хроматическое число может быть определено как минимальное число независимых множеств, на которое можно разбить вершины графа.

Пусть $V_1 \sqcup \ldots \sqcup V_\chi$ — разбиение $V(G)$ на независимые множества.

Пусть для каждой $v\in V(G)$ задан список допустимых цветов $L_v$, где $|L_v|=\lceil \chi \ln|G|\rceil$.

Для удобства введем множество $L := \bigcup_{v\in V(G)}L_v$ — объединение всех списков допустимых цветов по всем вершинам. 

Построим множества $\hat L_1,\ldots, \hat L_\chi$, каждое из которых — подмножество $L$, по правилу:
- для каждого элемента $l\in L$ подбрасываем $\chi$-гранную кость, и «кладем» $l$ в то из множеств, номер которого выпал

В результате получаем случайное разбиение
$$L=\hat L_1\sqcup\ldots\sqcup\hat L_\chi$$
Так как процесс случайный, какие-то множества могут оказаться пустыми, однако, это происходит с небольшой вероятностью.

Пусть $v\in V_i$ — фиксированная вершина, которая находится в $i$-м независимом множестве. Эта вершина в обычной $\chi$-цветной раскраске была покрашена в $i$-й цвет.

Вероятность того, что список цветов, допустимых для этой вершины, не пересекается со множеством $\hat L _i$, которое было назначен для данного цветого класса $L_v\cap\hat L_i=\varnothing$, равна
$$\bigg(\frac{\chi-1}{\chi}\bigg)^{|L_v|}\le\bigg(1-\frac{1}{\chi}\bigg)^{\chi\cdot\ln|G|}<e^{-\ln|G|}=\frac{1}{|G|}$$
Каждый раз, когда выбирался цвет из множества $L$, который, на самом деле принадлежал множеству $L_v$ и для этого цвета подкидывалась игральная кость, эта игральная кость не выпадала на свою $i$-ю грань. 

Вероятность того, что *хотя бы для одной вершины* окажется $L_v\cap \hat L_i=\varnothing$, не превосходит
$$\sum_{v\in V(G)}\bigg(\frac{\chi-1}{\chi}\bigg)^{|L_v|}<\sum_{v\in V(G)}\frac{1}{|G|}=1$$
Итак, с положительной вероятностью при случайном разбиении $L=\hat L_1 \sqcup \ldots \sqcup \hat L_\chi$ для всех $i=1,\ldots,\chi$ и для всех вершин $v\in V_i$ имеем
$$L_v\cap\hat L_i \ne \varnothing$$
Значит существует разбиение с такими свойствами.

Теперь для каждого $i$ и каждой вершины $v\in V_i$ выберем цвет этой вершины из (непустого) множества $L_v\cap \hat L_i$. 

## оценка $\chi_l(G)$ снизу через $\delta(G)$

Для обычного $\chi$ есть оценка сверху через $\Delta+1$, а нижней оценки через степени вершин графа нет. Для списочного хроматического числа можно дать нижнюю оценку через минимальную степень вершин в графе.

Для любого $G$ при всех достаточно больших $\delta(G)$ выполнено
$$\chi_l(G)\ge\frac{1}{4}\cdot \log_2\delta(G)$$

Для доказательства возьмем произвольный граф и в этом графе выберем некоторым образом двудольный подграф. Для вершин этого двудольного подграфа выберем списки так, чтобы нельзя было покрасить подграф в цвета из данных списков.

Пусть размер списков $s:=\big\lfloor\frac{1}{4}\cdot \log_2\delta\big\rfloor$ и пусть множество, из которого будут выбраны цвета, $\mathcal L := \{1,2,\ldots,s^2\}$.

Построим множество вершин, которое будет одной из долей двудольного подграфа $B\subseteq V(G)$ по правилу:
- каждая вершина $G$ берется в $B$ с вероятностью $1/\sqrt \delta$ 
- список допустимых цветов для $u\in B$ выбирается равновероятно среди всех $s$-подмножеств $\mathcal{L}$

Вершина, которая берется не из множества $v\in V(G)\backslash B$ сложная, если для любого набора цветов $L \subset \mathcal L$, такого, что $|L|\ge s^2/2$, найдется такая вершина среди соседей вершины $v$ $u\in  N(v)\cap B$, такая, что список допустимых цветов которой $L_u\subseteq L$.

То есть сложные вершины лежат вне множества $B$.

Вероятность того, что какая-то вершина графа, после случайного выбора множества $B$ и случайного выбора списков допустимых цветов множества $B$, оказалась не сложной
$$Pr\{v \text{ не сложная}\}\le \frac{1}{\sqrt \delta}+ \bigg(1-\frac{1}{\sqrt \delta}\bigg)\binom{s^2}{s^2/2}\cdot \bigg(1-\frac{1}{\sqrt\delta}\cdot\frac{\binom{s^2/2}{2}}{\binom{s^2}{s}}\bigg)^\delta$$
- те вершины, которые попали в множество $B$ по определению не сложные, это может произойти с вероятностью $1/\sqrt\delta$
- с вероятностью $(1-1/\sqrt\delta)$ эта вершина не попадает в $B$ и дальше может найтись какой-то список цветов размера $s^2/2$ из множества $\mathcal L$, за его выбор отвечает биномиальный коэффициент
$$\binom{s^2}{s^2/2}$$
список такой, что для него не существует вершины во множестве $B$ список $L_u$ которой целиком содержится в $L$. У вершины $v$ по крайней мере $\delta$ соседей (это степень в формуле), то есть для каждого из соседей вершины $v$ должна постигать неудача, состоящая в том, что либо этот сосед вершины $v$ вообще не попал во множество $B$, либо он попал во множество $B$, но при этом, список его допустимых цветов не содержится целиком внутри $L$. Сомножитель $1/\sqrt\delta$ внутри последней скобки отвечает за попадание или не попадание в $B$. За то, что список цветов $L_u$ не содержится в $L$ отвечает отношение
$$\frac{\binom{s^2/2}{2}}{\binom{s^2}{s}}$$
В последней скобке стоит событие обратное следующему: вершина попала во множество $B$ и список ее цветов выбирался среди всех $s$-элементных подмножеств не всей совокупности $\mathcal L$, а множества $L$. Есть $\binom{s^2/2}{2}$ подмножеств множества $L$ и $\binom{s^2}{s}$ подмножеств размера $s$ в $\mathcal L$. С этой вероятностью список цветов оказывается хорошим.

В силу неравенства $(1-x)\ge 4^{-x}$ при $x\le 1/2$, получаем
$$\begin{aligned}
\frac{\binom{s^2/2}{2}}{\binom{s^2}{s}}&=\prod_{k=0}^{s-1}\frac{s^2/2-k}{s^2-k}=2^{-s}\cdot\prod_{k=0}^{s-1}\bigg(1- \frac{k}{s^2-k}\bigg) \ge \\
&\ge 2^{-s}\cdot 2^{\sum_{k=0}^{s-1}\frac{-2k}{s^2-k}}\ge2^{-s}\cdot 2^{\sum_{k=0}^{s-1}\frac{-2k}{s^2-s}}= 2^{-s-1}
\end{aligned}$$

Пользуясь неравенством $(1-x)\le e^{-x}$, получаем
$$\begin{aligned}
\bigg(1-\frac{1}{\sqrt\delta}\cdot\frac{\binom{s^2/2}{2}}{\binom{s^2}{s}}\bigg)^\delta &\le (1-2^{-s-1}\cdot\delta^{-1/2})^\delta <\\
&< e^{-\delta^{1/2}2^{-s-1}}\le e^{-\delta^{1/4}/2}
\end{aligned}$$
Отсюда
$$\begin{aligned}
Pr\{v \text{ не сложная}\} &< \frac{1}{\sqrt\delta}+e^{s^{2}}\cdot e^{-\delta^{1/4}/2} <\\
&< \frac{1}{\sqrt\delta} + e^{\bigg(\frac{\log_2\delta}{4}\bigg)^2-\frac{\delta^{1/4}}{2}} < \frac{1}{4}
\end{aligned}$$

Теперь применим неравенство Маркова, так как оно позволяет оценить вероятность события через матожидание. Оценим матожидание числа несложных вершин графа
$$\mathbb{E} \text{ \# несложных вершин графа} < \frac{|G|}{4}$$
По неравенству Маркова
$$Pr\{\text{менее половины вершин графа сложные}\}< \frac{1}{2}$$
Теперь оценим вероятность того, что множество $B$ оказалось большим. Каждая вершина графа попадала в множество $B$ с вероятностью $1/\sqrt\delta$.  Матожидание размера множества $B$ по линейности матожидания
$$\mathbb E|B|=\frac{|G|}{\sqrt\delta}$$
и по неравенству Маркова
$$Pr\bigg\{|B|>2\cdot\frac{|G|}{\sqrt\delta}\bigg\}<\frac{1}{2}$$
значит с вероятностью $>0$ выполнены два условия:
- более половины вершин графа сложные
- $|B|<2\cdot\frac{|G|}{\sqrt\delta}$

Зафиксируем такие $B$, множество списков цветов для вершин $B$, и множество сложных вершин $A$, где $|A|\ge\frac{|G|}{2}$.

Зафиксируем до самого конца доказательства теоремы такие $A, B\subseteq V(G)$ и $\{L_u\}_{u\in B}$, для которых:
- $|A|\ge\frac{|G|}{2}$
- $|B|\le 2\cdot\frac{|G|}{\sqrt\delta}$
- для любой вершины $v\in A$  и для любого $L\subset\mathcal{L}$, такого, что $|L|\ge \frac{s^2}{2}$ найдется $u\in N(v)\cap B$, такая, что $L_u\subseteq L$

Теперь случайно выберем для каждой $v\in A$ список $L_v$, равновероятно среди всех $s$-подмножеств в $\mathcal L$.

Покажем, что с положительной вероятностью граф $G|_{A\cup B}$ не может быть правильно раскрашен в цвета из списков.

Пусть $v\in A$ и пусть $L_{N(v)}$  — множество всех цветов, встречающихся у соседей $v$ в $B$ и значит уже окрашенных.

Так как $v$ — сложная, то для любого множества $L\subset\mathcal L$, такого, что $|L|\ge\frac{s^2}{2}$, имеем $L_{N(v)} \cap L \ne \varnothing$. Отсюда $|L_{N(v)}|\ge\frac{s^2}{2}$.

Поэтому
$$Pr\{\text{можно выбрать цвет для } v \text{ из } L_v\}\le 1- \frac{\binom{s^2/2}{2}}{\binom{s^2}{s}}\le 1- 2^{-s-1}$$
Отсюда при фиксированной раскраске вершин из $B$ имеем
$$Pr\{\exists \text{ раскраска для } A\}\le s^{|B|}\cdot e^{-|G|\cdot 2^{-s-2}}$$